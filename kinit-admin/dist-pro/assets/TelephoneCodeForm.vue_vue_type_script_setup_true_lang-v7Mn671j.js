var v=(r,y,n)=>new Promise((_,u)=>{var p=s=>{try{o(n.next(s))}catch(d){u(d)}},m=s=>{try{o(n.throw(s))}catch(d){u(d)}},o=s=>s.done?_(s.value):Promise.resolve(s.value).then(p,m);o((n=n.apply(r,y)).next())});import{u as j,F as q}from"./useForm-BREZWcm3.js";import{e as B,u as L,t as w,G as N,g as O,d as U}from"./index-BSaZkSQ-.js";/* empty css                   *//* empty css                 */import{u as z}from"./useValidator-B2HgF5Uc.js";import{l as G,aB as T,Z,U as a,F as $,a as S,b as H,m as J,M as K,u as P,y as Q}from"./vue-chunks-o2h5QaLn.js";import{D as W,s as X,b as Y}from"./element-plus-BkD8NzPH.js";function b(r){return typeof r=="function"||Object.prototype.toString.call(r)==="[object Object]"&&!Q(r)}const ie=G({__name:"TelephoneCodeForm",emits:["to-password"],setup(r,{emit:y}){const n=y,{formRegister:_,formMethods:u}=j(),{getFormData:p,getElFormExpose:m}=u,{t:o}=U(),{required:s}=z(),{currentRoute:d,addRoute:R,push:C}=T(),f=B(),k=L(),x=Z([{field:"title",colProps:{span:24},formItemProps:{slots:{default:()=>a("h2",{class:"text-2xl font-bold text-center w-[100%]"},[o("login.login")])}}},{field:"telephone",label:o("login.telephone"),value:"",component:"Input",colProps:{span:24},componentProps:{style:{width:"100%"},placeholder:o("login.telephonePlaceholder"),maxlength:11}},{field:"password",label:o("login.SMSCode"),colProps:{span:24},formItemProps:{slots:{default:e=>a("div",{class:"w-[100%] flex"},[a(W,{modelValue:e.password,"onUpdate:modelValue":t=>e.password=t,placeholder:o("login.codePlaceholder")},{suffix:()=>{let t;return a($,null,[a(X,{direction:"vertical"},null),i.value?a(w,{type:"primary",link:!0,onClick:A},b(t=o("login.getSMSCode"))?t:{default:()=>[t]}):a(w,{type:"primary",disabled:!i.value,link:!0},{default:()=>[g.value+o("login.SMSCodeRetry")]})])}})])}}},{field:"method",label:"登录类型",value:"1",component:"Input",hidden:!0},{field:"login",colProps:{span:24},formItemProps:{slots:{default:()=>{let e,t;return a("div",{class:"w-[100%]"},[a("div",{class:"w-[100%]"},[a(w,{type:"primary",class:"w-[100%]",loading:h.value,onClick:E},b(e=o("login.login"))?e:{default:()=>[e]})]),a("div",{class:"w-[100%] mt-15px"},[a(w,{class:"w-[100%]",onClick:F},b(t=o("login.passwordLogin"))?t:{default:()=>[t]})])])}}}}]),I={telephone:[s()],method:[s()],password:[s()]},F=()=>{n("to-password")},h=S(!1),M=S("");H(()=>d.value,e=>{var t;M.value=(t=e==null?void 0:e.query)==null?void 0:t.redirect},{immediate:!0});const E=()=>v(this,null,function*(){const e=yield m();if(yield e==null?void 0:e.validate()){h.value=!0;const c=yield p();try{const l=yield k.login(c);l?l.data.is_reset_password?D():C({path:"/reset/password"}):h.value=!1}catch(l){h.value=!1}}});let i=S(!0),g=S(60);const A=()=>v(this,null,function*(){const e=yield m();if(yield e==null?void 0:e.validateField("telephone")){i.value=!1,g.value=60;const c=yield p();try{const l=yield N({telephone:c.telephone});if(l!=null&&l.data){let V=setInterval(()=>{g.value--,g.value<1&&(i.value=!0,clearInterval(V))},1e3)}else Y.error("发送失败，请联系管理员"),i.value=!0}catch(l){i.value=!0}}}),D=()=>v(this,null,function*(){const e=yield O();if(e){const t=e.data||[];yield f.generateRoutes(t).catch(()=>{}),f.getAddRouters.forEach(c=>{R(c)}),f.setIsAddRouters(!0),C({path:M.value||f.addRouters[0].path})}});return(e,t)=>(J(),K(P(q),{schema:x,rules:I,"label-position":"top","hide-required-asterisk":"",size:"large",class:"dark:border-1 dark:border-[var(--el-border-color)] dark:border-solid",onRegister:P(_)},null,8,["schema","onRegister"]))}});export{ie as _};
