var U=Object.defineProperty;var D=Object.getOwnPropertySymbols;var q=Object.prototype.hasOwnProperty,F=Object.prototype.propertyIsEnumerable;var P=(s,o,t)=>o in s?U(s,o,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[o]=t,T=(s,o)=>{for(var t in o||(o={}))q.call(o,t)&&P(s,t,o[t]);if(D)for(var t of D(o))F.call(o,t)&&P(s,t,o[t]);return s};var x=(s,o,t)=>new Promise((u,c)=>{var k=l=>{try{m(t.next(l))}catch(d){c(d)}},w=l=>{try{m(t.throw(l))}catch(d){c(d)}},m=l=>l.done?u(l.value):Promise.resolve(l.value).then(k,w);m((t=t.apply(s,o)).next())});import{u as J,_ as M}from"./Table.vue_vue_type_script_lang-C8htGDV6.js";import{d as G,v as V}from"./index-SAHUQZ2g.js";import{_ as K}from"./Search.vue_vue_type_script_setup_true_lang-DSCbi6Eq.js";import{_ as Q}from"./ContentWrap.vue_vue_type_script_setup_true_lang-Bq-Mkqar.js";import{_ as H}from"./Detail.vue_vue_type_script_setup_true_lang-fEFSoG2W.js";import{_ as W}from"./Dialog.vue_vue_type_style_index_0_lang-Bhm9ynpg.js";import{s as X}from"./dict-DJyIMlYA.js";import{u as Y}from"./dict-D8O779xT.js";import{f as Z,ao as ee,a as p,Q as $,M as n,F as y,K as z,h as O,i as te,G as b,u as a,q as L,L as ae,E as oe,J as re}from"./vue-chunks-wbK7PffK.js";import{g as se}from"./task-Ccqc7o_P.js";/* empty css                       *//* empty css                 *//* empty css                   */import"./element-plus-C0vem28W.js";/* empty css                        *//* empty css                    */import"./el-tooltip-l0sNRNKZ.js";/* empty css                  *//* empty css               *//* empty css                      *//* empty css                  *//* empty css                        *//* empty css                */import"./useForm-B5RQKQQi.js";/* empty css                     *//* empty css               *//* empty css                 *//* empty css                          *//* empty css                       *//* empty css                       *//* empty css                  *//* empty css                   *//* empty css                *//* empty css                    */import"./style.css_vue_type_style_index_0_src_true_lang-BFkgkg1x.js";import"./wang-editor-K_dPeC8b.js";/* empty css                   *//* empty css                    *//* empty css                         */import"./_Uint8Array-DZlgfqcV.js";import"./useIcon-DF_xcSd1.js";import"./Descriptions-DAQ5cpzp.js";/* empty css              *//* empty css                  */import"./dict-D1Ddn9_W.js";const Ye=Z({name:"SystemRecordTask",__name:"Task",setup(s){const{t:o}=G(),{currentRoute:t}=ee(),u=t.value.query.job_id,c=p([]);x(this,null,function*(){const e=yield Y().getDictObj(["vadmin_system_task_exec_strategy"]);c.value=e.vadmin_system_task_exec_strategy});const{tableRegister:w,tableState:m,tableMethods:l}=J({immediate:!1,fetchDataApi:()=>x(this,null,function*(){const{pageSize:r,currentPage:e}=m,i=yield se(T({page:a(e),limit:a(r)},a(v)));return{list:i.data||[],total:i.count||0}})}),{dataList:d,loading:B,total:N,pageSize:h,currentPage:f}=m,{getList:_}=l,A=$([{field:"job_id",label:"任务编号",show:!0,disabled:!0,width:"240px"},{field:"name",label:"任务名称",show:!0,disabled:!0},{field:"group",label:"任务分组",show:!0,span:2},{field:"job_class",label:"调用目标",show:!0},{field:"exec_strategy",label:"执行策略",show:!0,slots:{default:r=>{const e=r.row;return n(y,null,[n("div",null,[X(c.value,e.exec_strategy)])])}}},{field:"expression",label:"表达式",show:!0,span:24},{field:"start_time",label:"开始执行时间",show:!1,width:"200px"},{field:"end_time",label:"执行完成时间",width:"200px",show:!0},{field:"process_time",label:"耗时(秒)",width:"110px",show:!0},{field:"retval",label:"任务返回值",show:!0,slots:{default:r=>{const e=r.row;return JSON.parse(e.retval)}}},{field:"exception",label:"异常信息",show:!1,span:24},{field:"traceback",label:"堆栈跟踪",show:!1,width:"100px"},{field:"action",width:"100px",label:"操作",show:!0,disabled:!0,slots:{default:r=>{const e=r.row;return n(y,null,[n(V,{type:"primary",link:!0,size:"small",onClick:()=>I(e)},{default:()=>[z("详情")]})])}}}]),E=$([{field:"job_id",label:"任务编号",component:"Input",componentProps:{clearable:!0,style:{width:"240px"}},value:u},{field:"name",label:"任务名称",component:"Input",componentProps:{clearable:!0}}]),v=p({}),S=r=>{f.value=1,v.value=r,_()},g=p(!1),R=p(""),j=p(),C=p(""),I=r=>{R.value=o("exampleDemo.detail"),C.value="detail",j.value=r,g.value=!0};return u&&(v.value={job_id:u}),_(),(r,e)=>(O(),te(y,null,[n(a(Q),null,{default:b(()=>[n(a(K),{schema:E,onReset:S,onSearch:S},null,8,["schema"]),n(a(M),{"current-page":a(f),"onUpdate:currentPage":e[0]||(e[0]=i=>L(f)?f.value=i:null),"page-size":a(h),"onUpdate:pageSize":e[1]||(e[1]=i=>L(h)?h.value=i:null),showAction:"",columns:A,"node-key":"id",data:a(d),loading:a(B),pagination:{total:a(N)},onRegister:a(w),onRefresh:a(_)},null,8,["current-page","page-size","columns","data","loading","pagination","onRegister","onRefresh"])]),_:1}),n(a(W),{modelValue:g.value,"onUpdate:modelValue":e[3]||(e[3]=i=>g.value=i),title:R.value,width:"800px"},{footer:b(()=>[n(a(V),{onClick:e[2]||(e[2]=i=>g.value=!1)},{default:b(()=>[z(ae(a(o)("dialogDemo.close")),1)]),_:1})]),default:b(()=>[C.value==="detail"?(O(),oe(H,{key:0,"current-row":j.value},null,8,["current-row"])):re("",!0)]),_:1},8,["modelValue","title"])],64))}});export{Ye as default};
