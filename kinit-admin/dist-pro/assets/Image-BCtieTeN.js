var H=Object.defineProperty;var T=Object.getOwnPropertySymbols;var J=Object.prototype.hasOwnProperty,O=Object.prototype.propertyIsEnumerable;var M=(o,r,i)=>r in o?H(o,r,{enumerable:!0,configurable:!0,writable:!0,value:i}):o[r]=i,U=(o,r)=>{for(var i in r||(r={}))J.call(r,i)&&M(o,i,r[i]);if(T)for(var i of T(r))O.call(r,i)&&M(o,i,r[i]);return o};var d=(o,r,i)=>new Promise((_,h)=>{var y=n=>{try{g(i.next(n))}catch(m){h(m)}},x=n=>{try{g(i.throw(n))}catch(m){h(m)}},g=n=>n.done?_(n.value):Promise.resolve(n.value).then(y,x);g((i=i.apply(o,r)).next())});import{r as z,d as X,v as c,a2 as Y}from"./index-SAHUQZ2g.js";import{u as Z,_ as ee}from"./Table.vue_vue_type_script_lang-C8htGDV6.js";/* empty css               *//* empty css                        */import{_ as ae}from"./Search.vue_vue_type_script_setup_true_lang-DSCbi6Eq.js";import{_ as te}from"./ContentWrap.vue_vue_type_script_setup_true_lang-Bq-Mkqar.js";import{_ as le}from"./Write.vue_vue_type_style_index_0_lang-DSPxcMlO.js";import{_ as se}from"./Dialog.vue_vue_type_style_index_0_lang-Bhm9ynpg.js";import{af as ie,b as oe,p as re,j as ne}from"./element-plus-C0vem28W.js";import{f as ue,Q as q,M as t,F as R,K as f,a as p,h as me,i as pe,G as u,u as a,q as B,L as N}from"./vue-chunks-wbK7PffK.js";/* empty css                       *//* empty css                 *//* empty css                   *//* empty css                        *//* empty css                    */import"./el-tooltip-l0sNRNKZ.js";/* empty css                  *//* empty css               *//* empty css                      *//* empty css                  *//* empty css                */import"./useForm-B5RQKQQi.js";/* empty css                     *//* empty css                 *//* empty css                          *//* empty css                       *//* empty css                       *//* empty css                  *//* empty css                   *//* empty css                *//* empty css                    */import"./style.css_vue_type_style_index_0_src_true_lang-BFkgkg1x.js";import"./wang-editor-K_dPeC8b.js";/* empty css                   *//* empty css                    *//* empty css                         */import"./_Uint8Array-DZlgfqcV.js";import"./useIcon-DF_xcSd1.js";import"./useValidator-UROf_CnT.js";/* empty css                  */const de=o=>z.get({url:"/vadmin/resource/images",params:o}),j=o=>z.post({url:"/vadmin/resource/images",headersType:"multipart/form-data",data:o}),ce=o=>z.delete({url:"/vadmin/resource/images",data:o}),aa=ue({name:"ResourceImage",__name:"Image",setup(o){const{t:r}=X(),{tableRegister:i,tableState:_,tableMethods:h}=Z({fetchDataApi:()=>d(this,null,function*(){const{pageSize:l,currentPage:e}=_,s=yield de(U({page:a(e),limit:a(l)},a(A)));return{list:s.data||[],total:s.count||0}}),fetchDelApi:l=>d(this,null,function*(){return(yield ce(l)).code===200})}),{dataList:y,loading:x,total:g,pageSize:n,currentPage:m}=_,{getList:k,delList:$}=h,D=q([{field:"selection",type:"selection",show:!0,disabled:!0},{field:"id",label:"编号",show:!0,disabled:!1,align:"center",headerAlign:"center",width:"80px"},{field:"image_url",label:"图片",show:!0,disabled:!0,minWidth:"90px",slots:{default:l=>{const e=l.row;return t(R,null,[t("div",{class:"resource-image-name flex items-center"},[t("div",null,[t(ie,{src:`${e.image_url}?x-oss-process=image/resize,m_fixed,h_100`,"zoom-rate":1.2,"preview-src-list":y.value.map(s=>s.image_url),"preview-teleported":!0,"initial-index":l.$index,style:"height: 60px; display: block",fit:"cover"},null)]),t("div",{class:"leading-[35px] ml-2 truncate"},[t("span",null,[e.filename])])])])}}},{field:"remark",label:"备注",show:!1,disabled:!1},{field:"update_datetime",label:"更新时间",show:!1,width:"180px"},{field:"create_datetime",label:"创建时间",width:"180px",show:!0},{field:"create_user.name",label:"创建人",show:!1},{field:"action",width:"200px",label:"操作",fixed:"right",disabled:!1,show:!0,slots:{default:l=>{const e=l.row;return t(R,null,[t(c,{type:"primary",link:!0,size:"small",onClick:()=>F(e.id)},{default:()=>[f("复制编号")]}),t(c,{type:"primary",link:!0,size:"small",onClick:()=>F(e.image_url)},{default:()=>[f("复制链接")]}),t(c,{type:"danger",loading:b.value,link:!0,size:"small",onClick:()=>L(e)},{default:()=>[f("删除")]})])}}}]),G=q([{field:"filename",label:"文件名称",component:"Input",componentProps:{clearable:!1,style:{width:"214px"}}}]),A=p({}),I=l=>{m.value=1,A.value=l,k()},b=p(!1),L=l=>d(this,null,function*(){b.value=!0,l?yield $(!0,[l.id]).finally(()=>{b.value=!1}):yield $(!0).finally(()=>{b.value=!1})}),v=p(!1),P=p(""),S=p(),K=p(""),E=p(),C=p(!1),F=l=>d(this,null,function*(){const{copy:e}=Y();return yield e(l),oe.success("复制成功")}),Q=()=>{P.value="新增图片素材",K.value="add",S.value=void 0,v.value=!0},W=()=>d(this,null,function*(){const l=a(E),e=yield l==null?void 0:l.submit();if(e){if(C.value=!0,e==null||e.images.forEach(s=>s.status="uploading"),(e==null?void 0:e.upload_method)==="2")for(const s of e==null?void 0:e.images){const w=new FormData;w.append("file",s.raw),yield j(w),s.status="success"}else if((e==null?void 0:e.upload_method)==="1"){const s=e==null?void 0:e.images.map(w=>d(this,null,function*(){const V=new FormData;V.append("file",w.raw),yield j(V),w.status="success"}));yield Promise.all(s)}k(),v.value=!1,C.value=!1}});return(l,e)=>(me(),pe(R,null,[t(a(te),null,{default:u(()=>[t(a(ae),{schema:G,onReset:I,onSearch:I},null,8,["schema"]),t(a(ee),{"current-page":a(m),"onUpdate:currentPage":e[1]||(e[1]=s=>B(m)?m.value=s:null),"page-size":a(n),"onUpdate:pageSize":e[2]||(e[2]=s=>B(n)?n.value=s:null),showAction:"",columns:D,"default-expand-all":"","node-key":"id",data:a(y),loading:a(x),pagination:{total:a(g)},onRegister:a(i),onRefresh:a(k)},{toolbar:u(()=>[t(a(re),{gutter:10},{default:u(()=>[t(a(ne),{span:1.5},{default:u(()=>[t(a(c),{type:"primary",onClick:Q},{default:u(()=>[f("新增图片素材")]),_:1}),t(a(c),{type:"danger",onClick:e[0]||(e[0]=s=>L(null))},{default:u(()=>[f("批量删除")]),_:1})]),_:1})]),_:1})]),_:1},8,["current-page","page-size","columns","data","loading","pagination","onRegister","onRefresh"])]),_:1}),t(a(se),{modelValue:v.value,"onUpdate:modelValue":e[4]||(e[4]=s=>v.value=s),title:P.value,width:"996px",height:"600px",top:"3vh"},{footer:u(()=>[t(a(c),{type:"primary",loading:C.value,onClick:W},{default:u(()=>[f(N(a(r)("exampleDemo.save")),1)]),_:1},8,["loading"]),t(a(c),{onClick:e[3]||(e[3]=s=>v.value=!1)},{default:u(()=>[f(N(a(r)("dialogDemo.close")),1)]),_:1})]),default:u(()=>[t(le,{ref_key:"writeRef",ref:E,"current-row":S.value},null,8,["current-row"])]),_:1},8,["modelValue","title"])],64))}});export{aa as default};
