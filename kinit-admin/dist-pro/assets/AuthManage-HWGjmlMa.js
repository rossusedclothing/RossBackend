var g=(p,C,m)=>new Promise((f,x)=>{var n=i=>{try{_(m.next(i))}catch(h){x(h)}},v=i=>{try{_(m.throw(i))}catch(h){x(h)}},_=i=>i.done?f(i.value):Promise.resolve(i.value).then(n,v);_((m=m.apply(p,C)).next())});import{I as F,B as J,_ as U}from"./index-SAHUQZ2g.js";import{e as S}from"./tree-D8D4nCL3.js";/* empty css                   *//* empty css                   *//* empty css                 *//* empty css               *//* empty css                  *//* empty css                  *//* empty css                *//* empty css                    */import{u as z}from"./dict-D8O779xT.js";import{c as G}from"./menu-CtZuxorH.js";import{c as H}from"./dept-DZp9JQ7b.js";import{p as P}from"./role-BRNJ_dag.js";import{ag as B,ah as $,s as E,ai as q,F as Q,G as W,aj as M,ak as X,al as Y,b as j}from"./element-plus-C0vem28W.js";import{f as Z,a as c,b as ee,a9 as te,h as k,i as R,M as r,G as u,u as e,j as o,L as ae,K as se,F as oe,$ as le,E as re,J as ne,au as ie,av as de,n as A}from"./vue-chunks-wbK7PffK.js";import"./dict-D1Ddn9_W.js";const O=p=>(ie("data-v-458fbc02"),p=p(),de(),p),ce={class:"auth-manage-main-view"},ue={class:"flex justify-between pt-[20px] pb-[20px]"},pe=O(()=>o("span",null,"权限管理",-1)),fe={class:"h-12 flex justify-between mt-3 mr-3 ml-5"},me={class:"mt-1 text-[#909399]"},ve={class:"border-r-1 border-r-[#f0f0f0] b-r-solid h-[100%] p-[20px] box-border"},_e=O(()=>o("div",{class:"flex items-center"},[o("div",{class:"yxt-divider"}),o("span",null,"数据权限")],-1)),he={class:"ml-4 mt-3"},be={key:0,class:"mt-3 max-h-[65vh] b-1 b-solid b-[#e5e7eb] p-10px overflow-auto"},ye=O(()=>o("div",{class:"flex items-center"},[o("div",{class:"yxt-divider"}),o("span",null,"菜单权限")],-1)),ge={class:"mt-5 max-h-[70vh] b-1 b-solid b-[#e5e7eb] p-10px overflow-auto box-border"},xe=Z({__name:"AuthManage",props:{currentRow:{type:Object,default:()=>null}},emits:["getList"],setup(p,{expose:C,emit:m}){const f=p,x=m,n=c({});ee(()=>f.currentRow,a=>{a&&(n.value=JSON.parse(JSON.stringify(a)))},{deep:!0,immediate:!0});const v=c(!1),_=c(),i=()=>g(this,null,function*(){const t=yield z().getDictObj(["sys_vadmin_data_range"]);_.value=t.sys_vadmin_data_range}),h={children:"children",label:"label"};let V=c([]);const w=c(),I=()=>g(this,null,function*(){var t;const a=yield H();if(a&&(V.value=a.data,yield A(),f.currentRow)){const d=f.currentRow.depts.map(l=>l.id),s=[];S(a.data,l=>{d.includes(l.value)&&s.push(l.value)});for(const l of s)(t=e(w))==null||t.setChecked(l,!0,!1)}});let D=c([]);const b=c(),K=()=>g(this,null,function*(){var t;const a=yield G();if(a&&(D.value=a.data,yield A(),f.currentRow)){const d=f.currentRow.menus.map(l=>l.id),s=[];S(a.data,l=>{d.includes(l.value)&&s.push(l.value)});for(const l of s)(t=e(b))==null||t.setChecked(l,!0,!1)}}),y=c(!1),N=()=>g(this,null,function*(){var t,d,s;if(y.value)return;if(J(n.value.data_range)){j.error("数据范围选择项不能为空！");return}y.value=!0;const a=[...((t=e(b))==null?void 0:t.getCheckedKeys())||[],...((d=e(b))==null?void 0:d.getHalfCheckedKeys())||[]];n.value.menu_ids=a,n.value.dept_ids=(s=e(w))==null?void 0:s.getCheckedKeys();try{(yield P(n.value))&&(y.value=!1,j.success("保存成功"),T(),x("getList"))}finally{y.value=!1}}),L=()=>{v.value=!0,K(),I()},T=()=>{var a,t;v.value=!1,n.value={},(a=e(b))==null||a.setCheckedKeys([]),(t=e(w))==null||t.setCheckedKeys([])};return i(),C({openDrawer:L}),(a,t)=>{const d=te("BaseButton");return k(),R("div",ce,[r(e(Y),{modelValue:v.value,"onUpdate:modelValue":t[1]||(t[1]=s=>v.value=s),"with-header":!1,size:1e3,"before-close":T},{default:u(()=>[r(e(B),null,{default:u(()=>[r(e($),null,{default:u(()=>[o("div",ue,[pe,o("span",{onClick:T,class:"flex cursor-pointer"},[r(e(F),{icon:"iconamoon:close-thin",size:23})])])]),_:1}),r(e(E)),o("div",fe,[o("div",me,[o("span",null,"角色名称："+ae(n.value.name),1)]),r(d,{type:"primary",loading:y.value,onClick:N},{default:u(()=>[se("保存")]),_:1},8,["loading"])]),r(e(E)),r(e(B),null,{default:u(()=>[r(e(q),{width:"450px"},{default:u(()=>[o("div",ve,[o("div",null,[_e,o("div",he,[r(e(Q),{modelValue:n.value.data_range,"onUpdate:modelValue":t[0]||(t[0]=s=>n.value.data_range=s),placeholder:"请选择数据范围"},{default:u(()=>[(k(!0),R(oe,null,le(_.value,s=>(k(),re(e(W),{key:s.value,label:s.label,value:s.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),n.value.data_range==="3"?(k(),R("div",be,[r(e(M),{ref_key:"deptTreeRef",ref:w,data:e(V),"show-checkbox":"","node-key":"value",props:h,"default-expand-all":!0,"check-strictly":!0},null,8,["data"])])):ne("",!0)])])])]),_:1}),r(e(X),null,{default:u(()=>[ye,o("div",ge,[r(e(M),{ref_key:"menuTreeRef",ref:b,data:e(D),"show-checkbox":"","node-key":"value",props:h,"default-expand-all":!0,"check-strictly":!1},null,8,["data"])])]),_:1})]),_:1})]),_:1}),r(e(E))]),_:1},8,["modelValue"])])}}}),Fe=U(xe,[["__scopeId","data-v-458fbc02"]]);export{Fe as default};
