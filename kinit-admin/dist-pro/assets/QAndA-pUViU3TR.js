var ae=Object.defineProperty,ue=Object.defineProperties;var re=Object.getOwnPropertyDescriptors;var D=Object.getOwnPropertySymbols;var de=Object.prototype.hasOwnProperty,ce=Object.prototype.propertyIsEnumerable;var G=(v,m,i)=>m in v?ae(v,m,{enumerable:!0,configurable:!0,writable:!0,value:i}):v[m]=i,L=(v,m)=>{for(var i in m||(m={}))de.call(m,i)&&G(v,i,m[i]);if(D)for(var i of D(m))ce.call(m,i)&&G(v,i,m[i]);return v},P=(v,m)=>ue(v,re(m));var B=(v,m,i)=>new Promise((d,c)=>{var q=u=>{try{g(i.next(u))}catch(x){c(x)}},k=u=>{try{g(i.throw(u))}catch(x){c(x)}},g=u=>u.done?d(u.value):Promise.resolve(u.value).then(q,k);g((i=i.apply(v,m)).next())});import{a as y,Q as O,d as I,e as J,h as l,i as r,j as e,K as w,L as a,M as p,G as A,u as b,F as Q,$ as V,J as h,W as K,E as _e}from"./vue-chunks-wbK7PffK.js";import{g as me,a as xe,p as ve,b as ge,d as be,c as fe,e as pe,f as he}from"./questiong-rnLsr9Ml.js";import"./index-SAHUQZ2g.js";/* empty css                 *//* empty css                  *//* empty css               *//* empty css                  *//* empty css                    */import{d as $,D as E,G as R,F as ye}from"./element-plus-C0vem28W.js";const we={class:"min-h-screen bg-gray-50 p-6"},qe={class:"max-w-6xl mx-auto"},ke={class:"bg-white rounded-lg shadow-lg p-6"},Ae={class:"flex justify-between items-center mb-6"},Ce={class:"text-3xl font-bold text-gray-800"},Qe={class:"space-y-4"},Ve={class:"flex justify-between items-start mb-3"},Fe={class:"flex-1"},je={class:"text-lg font-semibold text-gray-800 mb-2"},Le={class:"text-gray-600"},Pe={class:"flex space-x-2 ml-4"},Be=["onClick"],$e=["onClick"],Ee=["onClick"],Me={key:0,class:"mt-4 pl-4 border-l-2 border-blue-200"},Se={class:"flex justify-between items-center mb-3"},Ne=e("h4",{class:"text-md font-medium text-gray-700"},"相关答案",-1),Ue=["onClick"],ze={class:"space-y-2"},De={class:"flex justify-between items-start"},Ge={class:"flex-1"},Oe={class:"text-gray-800 mb-1"},Ie={key:0,class:"text-sm text-blue-600"},Je={class:"flex space-x-2 ml-4"},Ke=["onClick"],Re=["onClick"],Te={key:0,class:"text-gray-500 text-center py-4"},We={key:0,class:"text-center py-8 text-gray-500"},He={key:0,class:"mt-8 bg-gray-50 p-4 rounded-lg"},Xe=e("h3",{class:"text-lg font-semibold mb-4 text-gray-800"},"问题流程图",-1),Ye={class:"space-y-2"},Ze={class:"font-medium text-blue-600"},et={class:"ml-4 mt-1"},tt={key:0,class:"text-green-600"},st={key:0,class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50"},nt={class:"bg-white rounded-lg p-6 w-full max-w-md mx-4"},ot={class:"text-xl font-bold mb-4 text-gray-800"},it={class:"mb-4"},lt=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"问题内容",-1),at={class:"flex justify-end space-x-3"},ut={type:"submit",class:"px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition-colors"},rt={key:1,class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50"},dt={class:"bg-white rounded-lg p-6 w-full max-w-md mx-4"},ct={class:"text-xl font-bold mb-4 text-gray-800"},_t={class:"mb-4"},mt=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"答案内容",-1),xt={class:"mb-4"},vt=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"客户打的标签（可选）",-1),gt={class:"mb-4"},bt=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"下一个问题（可选）",-1),ft={class:"flex justify-end space-x-3"},pt={type:"submit",class:"px-4 py-2 bg-green-500 text-white rounded-lg hover:bg-green-600 transition-colors"},jt={__name:"QAndA",props:{tabParams:{type:Object,default:()=>({})}},emits:["switch-tab"],setup(v,{emit:m}){const i=v,d=y([{id:1,question:"您对我们的产品满意吗？"},{id:2,question:"您希望我们改进哪些方面？"},{id:3,question:"您会推荐给朋友吗？"}]),c=y([{id:1,question_id:1,answer:"非常满意",next_question:3},{id:2,question_id:1,answer:"一般满意",next_question:2},{id:3,question_id:1,answer:"不满意",next_question:2},{id:4,question_id:2,answer:"价格方面",next_question:null},{id:5,question_id:2,answer:"功能方面",next_question:null},{id:6,question_id:3,answer:"会推荐",next_question:null},{id:7,question_id:3,answer:"不会推荐",next_question:null}]),q=y(!1),k=y(!1),g=y(new Set),u=y(null),x=y(null),f=O({question:"",sale_agent_id:i.tabParams.sale_agent_id,template_id:i.tabParams.id}),o=O({question_id:null,answer:"",next_question:"",customer_tag:""});I(()=>{C()});const C=()=>B(this,null,function*(){const t=yield me();if(t.code===200&&t.data){d.value=t.data;const n=yield xe();n.code===200&&n.data?c.value=n.data:c.value=[]}else return[]}),T=J(()=>d.value.length>0?Math.max(...d.value.map(t=>t.id))+1:1),W=J(()=>c.value.length>0?Math.max(...c.value.map(t=>t.id))+1:1);function F(t){return c.value.filter(n=>n.question_id===t)}function H(t){return d.value.find(n=>n.id===t)}function X(){S(),q.value=!0}function M(){q.value=!1,u.value=null,S()}function S(){f.question=""}function Y(t){u.value=t,f.question=t.question,q.value=!0}function Z(){u.value?(u.value.question=f.question,u.value.sale_agent_id=i.tabParams.sale_agent_id,u.value.template_id=i.tabParams.id,ve(u.value).then(t=>{if(t.value){const n=d.value.findIndex(s=>s.id===u.value.id);n!==-1&&(d.value[n]=P(L({},d.value[n]),{question:f.question}))}})):ge({question:f.question,sale_agent_id:i.tabParams.sale_agent_id,template_id:i.tabParams.id}).then(t=>{t.value&&d.value.push({id:T.value,question:f.question})}),C(),M()}function ee(t){confirm("确定要删除这个问题吗？删除后相关答案也会被删除。")&&(d.value=d.value.filter(n=>n.id!==t),c.value=c.value.filter(n=>n.question_id!==t),g.value.delete(t),be([t]).then(n=>{C()}))}function te(t){U(),o.question_id=t,k.value=!0}function N(){k.value=!1,x.value=null,U()}function U(){o.question_id=null,o.answer="",o.next_question="",o.customer_tag=""}function se(t){x.value=t,o.question_id=t.question_id,o.answer=t.answer,o.next_question=t.next_question||"",o.customer_tag=t.customer_tag||"",k.value=!0}function ne(){if(x.value)x.value.answer=o.answer,x.value.next_question=o.next_question||null,x.value.customer_tag=o.customer_tag||"",fe(x.value).then(t=>{if(t.value){const n=c.value.findIndex(s=>s.id===x.value.id);n!==-1&&(c.value[n]=P(L({},c.value[n]),{answer:o.answer,next_question:o.next_question||null,customer_tag:o.customer_tag||""}))}});else{const t={question_id:o.question_id,answer:o.answer,next_question:o.next_question||null,customer_tag:o.customer_tag||""};pe(t).then(n=>{n.value&&c.value.push({id:W.value,question_id:o.question_id,answer:o.answer,next_question:o.next_question||null,customer_tag:o.customer_tag||""})})}N()}function oe(t){confirm("确定要删除这个答案吗？")&&he([t]).then(n=>{n.value&&(c.value=c.value.filter(s=>s.id!==t))})}function ie(t){g.value.has(t)?g.value.delete(t):g.value.add(t)}return I(()=>B(this,null,function*(){})),(t,n)=>(l(),r("div",we,[e("div",qe,[e("div",ke,[e("div",Ae,[e("h1",Ce,[w(a(i.tabParams.title)+" ",1),p(b($),{onClick:C,color:"blue"},{default:A(()=>[w("✔保存")]),_:1}),p(b($),{onClick:C,color:"amber"},{default:A(()=>[w("⭕刷新")]),_:1})]),p(b($),{onClick:X,color:"blue",class:"bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded-lg transition-colors"},{default:A(()=>[w(" 新增问题 ")]),_:1})]),e("div",Qe,[(l(!0),r(Q,null,V(d.value,(s,j)=>(l(),r("div",{key:s.id,class:"border border-gray-200 rounded-lg p-4"},[e("div",Ve,[e("div",Fe,[e("h3",je," 问题 #"+a(j+1)+": "+a(s.question),1),e("p",Le,a(s.question),1)]),e("div",Pe,[e("button",{onClick:_=>Y(s),class:"text-blue-500 hover:text-blue-700 px-3 py-1 rounded"}," 编辑 ",8,Be),e("button",{onClick:_=>ee(s.id),class:"text-red-500 hover:text-red-700 px-3 py-1 rounded"}," 删除 ",8,$e),e("button",{onClick:_=>ie(s.id),class:"bg-green-500 hover:bg-green-600 text-white px-3 py-1 rounded transition-colors"},a(g.value.has(s.id)?"收起答案":"查看答案"),9,Ee)])]),g.value.has(s.id)?(l(),r("div",Me,[e("div",Se,[Ne,e("button",{onClick:_=>te(s.id),class:"bg-green-500 hover:bg-green-600 text-white px-3 py-1 rounded text-sm transition-colors"}," 新增答案 ",8,Ue)]),e("div",ze,[(l(!0),r(Q,null,V(F(s.id),_=>{var z;return l(),r("div",{key:_.id,class:"bg-gray-50 p-3 rounded border"},[e("div",De,[e("div",Ge,[e("p",Oe,a(_.answer),1),_.next_question?(l(),r("p",Ie," → 跳转到问题 #"+a(_.next_question)+": "+a((z=H(_.next_question))==null?void 0:z.question),1)):h("",!0)]),e("div",Je,[e("button",{onClick:le=>se(_),class:"text-blue-500 hover:text-blue-700 text-sm px-2 py-1 rounded"}," 编辑 ",8,Ke),e("button",{onClick:le=>oe(_.id),class:"text-red-500 hover:text-red-700 text-sm px-2 py-1 rounded"}," 删除 ",8,Re)])])])}),128)),F(s.id).length===0?(l(),r("div",Te," 暂无答案 ")):h("",!0)])])):h("",!0)]))),128)),d.value.length===0?(l(),r("div",We," 暂无问题，点击上方按钮添加第一个问题 ")):h("",!0)]),d.value.length>0?(l(),r("div",He,[Xe,e("div",Ye,[(l(!0),r(Q,null,V(d.value,(s,j)=>(l(),r("div",{key:s.id,class:"text-sm"},[e("span",Ze,"问题 #"+a(j+1)+" "+a(s.question),1),e("div",et,[(l(!0),r(Q,null,V(F(s.id),_=>(l(),r("div",{key:_.id,class:"text-gray-600"},[w(' "'+a(_.answer)+'" ',1),_.next_question?(l(),r("span",tt," → 问题 #"+a(_.next_question),1)):h("",!0)]))),128))])]))),128))])])):h("",!0)])]),q.value?(l(),r("div",st,[e("div",nt,[e("h2",ot,a(u.value?"编辑问题":"新增问题"),1),e("form",{onSubmit:K(Z,["prevent"])},[e("div",it,[lt,p(b(E),{type:"textarea",modelValue:f.question,"onUpdate:modelValue":n[0]||(n[0]=s=>f.question=s),class:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",rows:"4",placeholder:"请输入问题内容...",required:""},null,8,["modelValue"])]),e("div",at,[e("button",{type:"button",onClick:M,class:"px-4 py-2 text-gray-600 border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors"}," 取消 "),e("button",ut,a(u.value?"更新":"保存"),1)])],32)])])):h("",!0),k.value?(l(),r("div",rt,[e("div",dt,[e("h2",ct,a(x.value?"编辑答案":"新增答案"),1),e("form",{onSubmit:K(ne,["prevent"])},[e("div",_t,[mt,p(b(E),{type:"textarea",modelValue:o.answer,"onUpdate:modelValue":n[1]||(n[1]=s=>o.answer=s),class:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent",rows:"3",placeholder:"请输入答案内容...",required:""},null,8,["modelValue"])]),e("div",xt,[vt,p(b(E),{type:"text",modelValue:o.customer_tag,"onUpdate:modelValue":n[2]||(n[2]=s=>o.customer_tag=s),class:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent",placeholder:"回答这问题之后给客户打的标签,默认为空"},null,8,["modelValue"])]),e("div",gt,[bt,p(b(ye),{modelValue:o.next_question,"onUpdate:modelValue":n[3]||(n[3]=s=>o.next_question=s),class:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent"},{default:A(()=>[p(b(R),{value:""},{default:A(()=>[w("无跳转")]),_:1}),(l(!0),r(Q,null,V(d.value,s=>(l(),_e(b(R),{key:s.id,value:s.id,label:s.question.substring(0,50)},{default:A(()=>[w(" 问题 #"+a(s.id)+": "+a(s.question.substring(0,50))+a(s.question.length>50?"...":""),1)]),_:2},1032,["value","label"]))),128))]),_:1},8,["modelValue"])]),e("div",ft,[e("button",{type:"button",onClick:N,class:"px-4 py-2 text-gray-600 border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors"}," 取消 "),e("button",pt,a(x.value?"更新":"保存"),1)])],32)])])):h("",!0)]))}};export{jt as default};
