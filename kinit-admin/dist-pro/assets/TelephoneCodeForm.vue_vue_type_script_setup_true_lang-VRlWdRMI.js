var g=(r,_,n)=>new Promise((b,u)=>{var p=s=>{try{o(n.next(s))}catch(d){u(d)}},m=s=>{try{o(n.throw(s))}catch(d){u(d)}},o=s=>s.done?b(s.value):Promise.resolve(s.value).then(p,m);o((n=n.apply(r,_)).next())});import{u as j,F as q}from"./useForm-B5RQKQQi.js";import{e as L,u as N,v as w,H as B,g as O,d as z}from"./index-SAHUQZ2g.js";/* empty css                   *//* empty css                 */import{u as H}from"./useValidator-UROf_CnT.js";import{f as Q,ao as T,Q as U,M as a,F as $,a as S,b as G,h as J,E as K,u as P,l as W}from"./vue-chunks-wbK7PffK.js";import{D as X,s as Y,b as Z}from"./element-plus-C0vem28W.js";function y(r){return typeof r=="function"||Object.prototype.toString.call(r)==="[object Object]"&&!W(r)}const ie=Q({__name:"TelephoneCodeForm",emits:["to-password"],setup(r,{emit:_}){const n=_,{formRegister:b,formMethods:u}=j(),{getFormData:p,getElFormExpose:m}=u,{t:o}=z(),{required:s}=H(),{currentRoute:d,addRoute:R,push:C}=T(),f=L(),k=N(),x=U([{field:"title",colProps:{span:24},formItemProps:{slots:{default:()=>a("h2",{class:"text-2xl font-bold text-center w-[100%]"},[o("login.login")])}}},{field:"telephone",label:o("login.telephone"),value:"",component:"Input",colProps:{span:24},componentProps:{style:{width:"100%"},placeholder:o("login.telephonePlaceholder"),maxlength:11}},{field:"password",label:o("login.SMSCode"),colProps:{span:24},formItemProps:{slots:{default:e=>a("div",{class:"w-[100%] flex"},[a(X,{modelValue:e.password,"onUpdate:modelValue":t=>e.password=t,placeholder:o("login.codePlaceholder")},{suffix:()=>{let t;return a($,null,[a(Y,{direction:"vertical"},null),i.value?a(w,{type:"primary",link:!0,onClick:A},y(t=o("login.getSMSCode"))?t:{default:()=>[t]}):a(w,{type:"primary",disabled:!i.value,link:!0},{default:()=>[v.value+o("login.SMSCodeRetry")]})])}})])}}},{field:"method",label:"登录类型",value:"1",component:"Input",hidden:!0},{field:"login",colProps:{span:24},formItemProps:{slots:{default:()=>{let e,t;return a("div",{class:"w-[100%]"},[a("div",{class:"w-[100%]"},[a(w,{type:"primary",class:"w-[100%]",loading:h.value,onClick:F},y(e=o("login.login"))?e:{default:()=>[e]})]),a("div",{class:"w-[100%] mt-15px"},[a(w,{class:"w-[100%]",onClick:E},y(t=o("login.passwordLogin"))?t:{default:()=>[t]})])])}}}}]),I={telephone:[s()],method:[s()],password:[s()]},E=()=>{n("to-password")},h=S(!1),M=S("");G(()=>d.value,e=>{var t;M.value=(t=e==null?void 0:e.query)==null?void 0:t.redirect},{immediate:!0});const F=()=>g(this,null,function*(){const e=yield m();if(yield e==null?void 0:e.validate()){h.value=!0;const c=yield p();try{const l=yield k.login(c);l?l.data.is_reset_password?D():C({path:"/reset/password"}):h.value=!1}catch(l){h.value=!1}}});let i=S(!0),v=S(60);const A=()=>g(this,null,function*(){const e=yield m();if(yield e==null?void 0:e.validateField("telephone")){i.value=!1,v.value=60;const c=yield p();try{const l=yield B({telephone:c.telephone});if(l!=null&&l.data){let V=setInterval(()=>{v.value--,v.value<1&&(i.value=!0,clearInterval(V))},1e3)}else Z.error("发送失败，请联系管理员"),i.value=!0}catch(l){i.value=!0}}}),D=()=>g(this,null,function*(){const e=yield O();if(e){const t=e.data||[];yield f.generateRoutes(t).catch(()=>{}),f.getAddRouters.forEach(c=>{R(c)}),f.setIsAddRouters(!0),C({path:M.value||f.addRouters[0].path})}});return(e,t)=>(J(),K(P(q),{schema:x,rules:I,"label-position":"top","hide-required-asterisk":"",size:"large",class:"dark:border-1 dark:border-[var(--el-border-color)] dark:border-solid",onRegister:P(b)},null,8,["schema","onRegister"]))}});export{ie as _};
