var h=(_,n,r)=>new Promise((c,f)=>{var g=s=>{try{p(r.next(s))}catch(m){f(m)}},w=s=>{try{p(r.throw(s))}catch(m){f(m)}},p=s=>s.done?c(s.value):Promise.resolve(s.value).then(g,w);p((r=r.apply(_,n)).next())});import{u as G,F as E}from"./useForm-BREZWcm3.js";import{k as M,u as L,a as B,I,t as F,a4 as N,N as V}from"./index-BSaZkSQ-.js";/* empty css                    */import{u as D}from"./useValidator-B2HgF5Uc.js";import{a as P,Z as S,b as l}from"./element-plus-BkD8NzPH.js";import{l as T,e as R,Z as v,U as a,S as j,F as Z,a as x,m as q,M as J,u as O}from"./vue-chunks-o2h5QaLn.js";const ee=T({__name:"Basic",props:{tabId:M.number},setup(_){const{required:n}=D(),r=L(),c=B(),f=_,g=R(()=>r.getToken),w=v([{field:"web_title",label:"系统标题",colProps:{span:24},component:"Input",componentProps:{style:{width:"500px"}}},{field:"web_logo",label:"系统 LOGO",colProps:{span:24},formItemProps:{slots:{default:e=>a(S,{class:"system-settings-basic-image-uploader",action:"/api/vadmin/system/upload/image/to/local",data:{path:"system"},"show-file-list":!1,"before-upload":o=>{const u=["image/jpeg","image/gif","image/png"].includes(o.type),d=o.size/1024/1024<5;return u||l.error("上传LOGO图片必须是 JPG/GIF/PNG/ 格式!"),d||l.error("上传LOGO图片大小不能超过 5MB!"),u&&d},"on-success":o=>{o.code===200?e.web_logo=o.data.remote_path:l.error(o.message)},accept:"image/jpeg,image/gif,image/png",name:"file",headers:{Authorization:g}},{default:()=>[e.web_logo?a("img",{src:e.web_logo,class:"logo-image"},null):a(P,{class:"logo-image-uploader-icon"},{default:()=>[a(I,{icon:"akar-icons:plus",size:23},null)]})]})}}},{field:"web_desc",label:"系统描述",colProps:{span:24},component:"Input",componentProps:{rows:4,type:"textarea",style:{width:"500px"}}},{field:"web_ico",label:"ICO 图标",colProps:{span:24},formItemProps:{slots:{default:e=>a(S,{class:"system-settings-basic-image-uploader",action:"/api/vadmin/system/upload/image/to/local",data:{path:"system"},"show-file-list":!1,"before-upload":o=>{const u=["image/x-icon"].includes(o.type),d=o.size/1024/1024<2;return u||l.error("上传ICO图标必须是 ico 格式!"),d||l.error("上传ICO图标大小不能超过 2MB!"),u&&d},"on-success":o=>{o.code===200?(e.web_ico=o.data.remote_path,e.web_ico_local_path=o.data.local_path):l.error(o.message)},accept:"image/x-icon",name:"file",headers:{Authorization:g}},{default:()=>[e.web_ico?a("img",{src:e.web_ico,class:"ico-image"},null):a(P,{class:"ico-image-uploader-icon"},{default:()=>[a(I,{icon:"akar-icons:plus",size:23},null)]})]})}}},{field:"web_ico_local_path",label:"ICO 图标服务器文件地址",component:"Input",colProps:{span:24},hidden:!0},{field:"web_icp_number",label:"备案号",colProps:{span:24},component:"Input",componentProps:{style:{width:"500px"}}},{field:"web_copyright",label:"版权信息",colProps:{span:24},component:"Input",componentProps:{style:{width:"500px"}}},{field:"active",label:"",colProps:{span:24},formItemProps:{slots:{default:()=>a(Z,null,[a(F,{loading:b.value,type:"primary",onClick:C},{default:()=>[j("立即提交")]})])}}}]),p=v({web_title:[n()],web_logo:[n()],web_ico:[n()]}),{formRegister:s,formMethods:m}=G(),{setValues:U,getFormData:k,getElFormExpose:y}=m;let z=x({});const A=()=>h(this,null,function*(){const e=yield V({tab_id:f.tabId});if(e){yield U(e.data),z.value=e.data;const i=yield y();i==null||i.clearValidate()}}),b=x(!1),C=()=>h(this,null,function*(){const e=yield y();if(yield e==null?void 0:e.validate()){const t=yield k();if(b.value=!0,!t)return b.value=!1,l.error("未获取到数据");try{if(yield N(t))return c.setTitle(t.web_title||"后台系统"),c.setLogoImage(t.web_logo||"/media/system/logo.png"),c.setFooterContent(t.web_copyright||"Copyright ©2022-present K"),c.setIcpNumber(t.web_icp_number||""),l.success("更新成功")}finally{b.value=!1}}});return A(),(e,i)=>(q(),J(O(E),{rules:p,onRegister:O(s),schema:w},null,8,["rules","onRegister","schema"]))}});export{ee as _};
