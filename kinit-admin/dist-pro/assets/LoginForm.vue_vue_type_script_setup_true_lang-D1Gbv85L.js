var P=(a,h,n)=>new Promise((i,r)=>{var g=l=>{try{c(n.next(l))}catch(t){r(t)}},v=l=>{try{c(n.throw(l))}catch(t){r(t)}},c=l=>l.done?i(l.value):Promise.resolve(l.value).then(g,v);c((n=n.apply(a,h)).next())});import{u as q,F as B}from"./useForm-BREZWcm3.js";import{e as D,u as N,t as R,I as p,g as O,d as U}from"./index-BSaZkSQ-.js";/* empty css                    *//* empty css                */import{l as T,aB as Z,a as y,Z as $,U as o,F as _,b as G,m as H,M as J,u as C,y as K}from"./vue-chunks-o2h5QaLn.js";import{u as Q}from"./useValidator-B2HgF5Uc.js";import{a2 as W,r as X}from"./element-plus-BkD8NzPH.js";function I(a){return typeof a=="function"||Object.prototype.toString.call(a)==="[object Object]"&&!K(a)}const u="var(--el-color-primary)",m=30,f="#999",ne=T({__name:"LoginForm",emits:["to-telephone"],setup(a,{emit:h}){const n=h,{required:i}=Q(),r=D(),g=N(),{currentRoute:v,addRoute:c,push:l}=Z(),{t}=U(),k=y(!1),z={telephone:[i()],method:[i()],password:[i()]},F=$([{field:"title",colProps:{span:24},formItemProps:{slots:{default:()=>o("h2",{class:"text-2xl font-bold text-center w-[100%]"},[t("login.login")])}}},{field:"telephone",label:t("login.telephone"),value:"15020221010",component:"Input",colProps:{span:24},componentProps:{style:{width:"100%"},placeholder:t("login.telephonePlaceholder"),maxlength:11}},{field:"password",label:t("login.password"),value:"kinit2022",component:"InputPassword",colProps:{span:24},componentProps:{style:{width:"100%"},placeholder:t("login.passwordPlaceholder")}},{field:"method",label:"登录类型",value:"0",component:"Input",hidden:!0},{field:"tool",colProps:{span:24},formItemProps:{slots:{default:()=>{let e;return o(_,null,[o("div",{class:"flex justify-between items-center w-[100%]"},[o(W,{modelValue:k.value,"onUpdate:modelValue":s=>k.value=s,label:t("login.remember"),size:"small"},null),o(X,{type:"primary",underline:!1},I(e=t("login.forgetPassword"))?e:{default:()=>[e]})])])}}}},{field:"login",colProps:{span:24},formItemProps:{slots:{default:()=>{let e,s;return o(_,null,[o("div",{class:"w-[100%]"},[o(R,{loading:d.value,type:"primary",class:"w-[100%]",onClick:V},I(e=t("login.login"))?e:{default:()=>[e]})]),o("div",{class:"w-[100%] mt-15px"},[o(R,{class:"w-[100%]",onClick:M},I(s=t("login.smsLogin"))?s:{default:()=>[s]})])])}}}},{field:"other",component:"Divider",label:t("login.otherLogin"),componentProps:{contentPosition:"center"}},{field:"otherIcon",colProps:{span:24},formItemProps:{slots:{default:()=>o(_,null,[o("div",{class:"flex justify-between w-[100%]"},[o(p,{icon:"ant-design:github-filled",size:m,class:"cursor-pointer ant-icon",color:f,hoverColor:u},null),o(p,{icon:"ant-design:wechat-filled",size:m,class:"cursor-pointer ant-icon",color:f,hoverColor:u},null),o(p,{icon:"ant-design:alipay-circle-filled",size:m,color:f,hoverColor:u,class:"cursor-pointer ant-icon"},null),o(p,{icon:"ant-design:weibo-circle-filled",size:m,color:f,hoverColor:u,class:"cursor-pointer ant-icon"},null)])])}}}]),{formRegister:S,formMethods:j}=q(),{getFormData:E,getElFormExpose:L}=j,d=y(!1),x=y("");G(()=>v.value,e=>{var s;x.value=(s=e==null?void 0:e.query)==null?void 0:s.redirect},{immediate:!0});const V=()=>P(this,null,function*(){const e=yield L();if(yield e==null?void 0:e.validate()){d.value=!0;const w=yield E();try{const b=yield g.login(w);b?b.data.is_reset_password?A():l({path:"/reset/password"}):d.value=!1}catch(b){d.value=!1}}}),A=()=>P(this,null,function*(){const e=yield O();if(e){const s=e.data||[];yield r.generateRoutes(s).catch(()=>{}),r.getAddRouters.forEach(w=>{c(w)}),r.setIsAddRouters(!0),l({path:x.value||r.addRouters[0].path})}}),M=()=>{n("to-telephone")};return(e,s)=>(H(),J(C(B),{schema:F,rules:z,"label-position":"top","hide-required-asterisk":"",size:"large",class:"dark:border-1 dark:border-[var(--el-border-color)] dark:border-solid",onRegister:C(S)},null,8,["schema","onRegister"]))}});export{ne as _};
