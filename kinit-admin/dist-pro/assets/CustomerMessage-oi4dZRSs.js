var R=Object.defineProperty;var j=Object.getOwnPropertySymbols;var G=Object.prototype.hasOwnProperty,H=Object.prototype.propertyIsEnumerable;var L=(m,a,r)=>a in m?R(m,a,{enumerable:!0,configurable:!0,writable:!0,value:r}):m[a]=r,I=(m,a)=>{for(var r in a||(a={}))G.call(a,r)&&L(m,r,a[r]);if(j)for(var r of j(a))H.call(a,r)&&L(m,r,a[r]);return m};var k=(m,a,r)=>new Promise((h,_)=>{var C=n=>{try{V(r.next(n))}catch(l){_(l)}},D=n=>{try{V(r.throw(n))}catch(l){_(l)}},V=n=>n.done?h(n.value):Promise.resolve(n.value).then(C,D);V((r=r.apply(m,a)).next())});import{f as Q,Q as y,a as A,d as J,h as W,i as X,j as p,M as e,a0 as Y,u as t,G as i,K as g,L as E,au as Z,av as ee}from"./vue-chunks-wbK7PffK.js";import{_ as te}from"./index-SAHUQZ2g.js";/* empty css                        *//* empty css                    */import"./el-tooltip-l0sNRNKZ.js";/* empty css                  *//* empty css               *//* empty css                      *//* empty css                 *//* empty css                  *//* empty css                  *//* empty css                   *//* empty css                     *//* empty css                       */import{b as ae,e as se,f as oe,h as le}from"./customer-CdxaMlq0.js";import{D as v,d as f,t as w,u as re,v as ie,H as $,B as ne,C as M,b,w as de}from"./element-plus-C0vem28W.js";const z=m=>(Z("data-v-3a88a9f8"),m=m(),ee(),m),me={class:"p-4"},ue={class:"flex items-center justify-between mb-4"},pe={class:"flex items-center space-x-2"},ce={class:"text-sm text-gray-500"},_e={class:"mt-4 flex justify-end"},ge={class:"space-y-3"},fe=z(()=>p("strong",null,"客户名称：",-1)),ve=z(()=>p("strong",null,"手机号：",-1)),be=z(()=>p("div",null,[p("strong",null,"客户消息：")],-1)),ye=z(()=>p("div",null,[p("strong",null,"回复消息：")],-1)),we=Q({__name:"CustomerMessage",setup(m){const a=y({page:1,limit:10,total:0,v_order:"desc"}),r=A([]),h=y({keyword:""}),_=()=>k(this,null,function*(){var s;const d={page:a.page,limit:a.limit,keyword:h.keyword,v_order:a.v_order};try{const c=yield ae(d);c&&c.data?(r.value=c.data||[],a.total=(s=c.data.total)!=null?s:0):(r.value=[],a.total=0)}catch(c){console.error("fetchList error",c),b.error("获取消息列表失败")}}),C=()=>{a.page=1,_()},D=d=>{a.page=d,_()},V=d=>{a.limit=d,a.page=1,_()},n=y({visible:!1,data:null}),l=y({visible:!1,isEdit:!1,data_id:0}),S=A(),u=y({customer_name:"",customer_phone:"",customer_message:"",receiver_message:""}),q=y({customer_name:[{required:!0,message:"请输入客户名称",trigger:"blur"}],customer_phone:[{required:!0,message:"请输入手机号",trigger:"blur"}],customer_message:[{required:!0,message:"请输入客户消息",trigger:"blur"}]}),F=d=>{n.data=d,n.visible=!0},K=d=>{l.isEdit=!0,l.data_id=d.id,Object.assign(u,d),l.visible=!0},N=()=>{l.isEdit=!1,l.data_id=0,Object.assign(u,{customer_name:"",customer_phone:"",customer_message:"",receiver_message:""}),l.visible=!0},O=()=>{l.visible=!1},T=()=>{var d,s;(s=(d=S.value)==null?void 0:d.validate)==null||s.call(d,c=>k(this,null,function*(){if(c)if(l.isEdit&&l.data_id)try{yield se(l.data_id,I({},u)),b.success("更新成功"),l.visible=!1,_()}catch(o){b.error("更新失败")}else try{yield oe(I({},u)),b.success("创建成功"),l.visible=!1,_()}catch(o){b.error("创建失败")}}))},P=d=>{de.confirm("确认删除该消息记录吗？","删除确认",{type:"warning"}).then(()=>k(this,null,function*(){try{yield le([d.id]),b.success("删除成功"),_()}catch(s){b.error("删除失败")}})).catch(()=>{})};return J(()=>{_()}),(d,s)=>{var c;return W(),X("div",me,[p("div",ue,[p("div",pe,[e(t(v),{modelValue:h.keyword,"onUpdate:modelValue":s[0]||(s[0]=o=>h.keyword=o),placeholder:"搜索客户名称或手机号",clearable:"",onClear:C,onKeydown:Y(C,["enter"])},null,8,["modelValue"]),e(t(f),{plain:!0,onClick:C},{default:i(()=>[g("搜索")]),_:1}),e(t(f),{type:"primary",onClick:N},{default:i(()=>[g("新增消息")]),_:1})]),p("div",ce,"总数："+E(a.total),1)]),e(t(re),{data:r.value,stripe:"",style:{width:"100%"},"empty-text":"暂无数据"},{default:i(()=>[e(t(w),{prop:"id",label:"ID",width:"80"}),e(t(w),{prop:"customer_name",label:"客户名称"}),e(t(w),{prop:"customer_phone",label:"手机号"}),e(t(w),{prop:"customer_message",label:"客户消息","show-overflow-tooltip":""}),e(t(w),{prop:"receiver_message",label:"回复消息","show-overflow-tooltip":""}),e(t(w),{label:"操作",width:"220"},{default:i(o=>[e(t(f),{size:"small",onClick:x=>F(o.row)},{default:i(()=>[g("查看")]),_:2},1032,["onClick"]),e(t(f),{size:"small",type:"primary",onClick:x=>K(o.row)},{default:i(()=>[g("编辑")]),_:2},1032,["onClick"]),e(t(f),{size:"small",type:"danger",onClick:x=>P(o.row)},{default:i(()=>[g("删除")]),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"]),p("div",_e,[e(t(ie),{background:"",layout:"prev, pager, next, sizes, total","page-size":a.limit,"current-page":a.page,"page-sizes":[10,20,50,100],total:a.total,onSizeChange:V,onCurrentChange:D},null,8,["page-size","current-page","total"])]),e(t($),{modelValue:n.visible,"onUpdate:modelValue":s[2]||(s[2]=o=>n.visible=o),width:"700px",title:"消息详情 - "+(((c=n.data)==null?void 0:c.customer_name)||"")},{footer:i(()=>[e(t(f),{onClick:s[1]||(s[1]=o=>n.visible=!1)},{default:i(()=>[g("关闭")]),_:1})]),default:i(()=>{var o,x,U,B;return[p("div",ge,[p("div",null,[fe,g(E((o=n.data)==null?void 0:o.customer_name),1)]),p("div",null,[ve,g(E((x=n.data)==null?void 0:x.customer_phone),1)]),be,e(t(v),{type:"textarea",rows:4,"model-value":(U=n.data)==null?void 0:U.customer_message,disabled:""},null,8,["model-value"]),ye,e(t(v),{type:"textarea",rows:4,"model-value":(B=n.data)==null?void 0:B.receiver_message,disabled:""},null,8,["model-value"])])]}),_:1},8,["modelValue","title"]),e(t($),{modelValue:l.visible,"onUpdate:modelValue":s[7]||(s[7]=o=>l.visible=o),width:"640px",title:l.isEdit?"编辑消息":"新增消息"},{footer:i(()=>[e(t(f),{onClick:O},{default:i(()=>[g("取消")]),_:1}),e(t(f),{type:"primary",onClick:T},{default:i(()=>[g(E(l.isEdit?"保存":"创建"),1)]),_:1})]),default:i(()=>[e(t(ne),{model:u,rules:q,ref_key:"formRef",ref:S,"label-width":"120px",class:"space-y-2"},{default:i(()=>[e(t(M),{label:"客户名称",prop:"customer_name"},{default:i(()=>[e(t(v),{modelValue:u.customer_name,"onUpdate:modelValue":s[3]||(s[3]=o=>u.customer_name=o)},null,8,["modelValue"])]),_:1}),e(t(M),{label:"手机号",prop:"customer_phone"},{default:i(()=>[e(t(v),{modelValue:u.customer_phone,"onUpdate:modelValue":s[4]||(s[4]=o=>u.customer_phone=o)},null,8,["modelValue"])]),_:1}),e(t(M),{label:"客户消息",prop:"customer_message"},{default:i(()=>[e(t(v),{type:"textarea",rows:4,modelValue:u.customer_message,"onUpdate:modelValue":s[5]||(s[5]=o=>u.customer_message=o)},null,8,["modelValue"])]),_:1}),e(t(M),{label:"回复消息",prop:"receiver_message"},{default:i(()=>[e(t(v),{type:"textarea",rows:4,modelValue:u.receiver_message,"onUpdate:modelValue":s[6]||(s[6]=o=>u.receiver_message=o)},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue","title"])])}}}),qe=te(we,[["__scopeId","data-v-3a88a9f8"]]);export{qe as default};
