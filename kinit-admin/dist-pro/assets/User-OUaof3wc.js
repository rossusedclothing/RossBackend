var ie=Object.defineProperty;var B=Object.getOwnPropertySymbols;var oe=Object.prototype.hasOwnProperty,re=Object.prototype.propertyIsEnumerable;var N=(c,n,o)=>n in c?ie(c,n,{enumerable:!0,configurable:!0,writable:!0,value:o}):c[n]=o,z=(c,n)=>{for(var o in n||(n={}))oe.call(n,o)&&N(c,o,n[o]);if(B)for(var o of B(n))re.call(n,o)&&N(c,o,n[o]);return c};var v=(c,n,o)=>new Promise((C,D)=>{var $=u=>{try{A(o.next(u))}catch(h){D(h)}},R=u=>{try{A(o.throw(u))}catch(h){D(h)}},A=u=>u.done?C(u.value):Promise.resolve(u.value).then($,R);A((o=o.apply(c,n)).next())});import{d as ne,v as w,U as ue,s as de,V as pe,W as me,X as ce,Y as fe}from"./index-SAHUQZ2g.js";import{u as ve,_ as we}from"./Table.vue_vue_type_script_lang-C8htGDV6.js";/* empty css                  *//* empty css               */import{_ as _e}from"./Search.vue_vue_type_script_setup_true_lang-DSCbi6Eq.js";import{_ as ge}from"./ContentWrap.vue_vue_type_script_setup_true_lang-Bq-Mkqar.js";import{_ as he}from"./Write.vue_vue_type_script_setup_true_lang-DxNQz9h8.js";import{_ as be}from"./Dialog.vue_vue_type_style_index_0_lang-Bhm9ynpg.js";import{s as ye}from"./dict-DJyIMlYA.js";import{u as ke}from"./dict-D8O779xT.js";import{_ as xe}from"./Import.vue_vue_type_script_setup_true_lang-BE-L3s_x.js";import{_ as Le}from"./PasswordSendSMS.vue_vue_type_script_setup_true_lang-BYQxHpF8.js";import{_ as Se}from"./PasswordSendEmail.vue_vue_type_script_setup_true_lang-Bjzfq-LY.js";import{V as Q,p as Pe,j as P,b as W}from"./element-plus-C0vem28W.js";import{f as Ce,a as p,Q as q,M as s,u as t,F as k,H as b,ag as G,K as _,h as m,i as Ae,G as i,q as H,E as g,a1 as De,L as J,J as Ue}from"./vue-chunks-wbK7PffK.js";/* empty css                       *//* empty css                 *//* empty css                   *//* empty css                        *//* empty css                    */import"./el-tooltip-l0sNRNKZ.js";/* empty css                  *//* empty css               *//* empty css                      *//* empty css                  *//* empty css                        *//* empty css                */import"./useForm-B5RQKQQi.js";/* empty css                     *//* empty css                 *//* empty css                          *//* empty css                       *//* empty css                       *//* empty css                   *//* empty css                *//* empty css                    */import"./style.css_vue_type_style_index_0_src_true_lang-BFkgkg1x.js";import"./wang-editor-K_dPeC8b.js";/* empty css                   *//* empty css                    *//* empty css                         */import"./_Uint8Array-DZlgfqcV.js";import"./useIcon-DF_xcSd1.js";import"./useValidator-UROf_CnT.js";import"./role-BRNJ_dag.js";import"./dept-DZp9JQ7b.js";/* empty css                  */import"./dict-D1Ddn9_W.js";/* empty css                *//* empty css                      */const Dt=Ce({name:"AuthUser",__name:"User",setup(c){const{t:n}=ne(),{tableRegister:o,tableState:C,tableMethods:D}=ve({fetchDataApi:()=>v(this,null,function*(){const{pageSize:a,currentPage:e}=C,l=yield de(z({page:t(e),limit:t(a)},t(V)));return{list:l.data||[],total:l.count||0}}),fetchDelApi:a=>v(this,null,function*(){return(yield pe(a)).code===200}),fetchExportApi:a=>v(this,null,function*(){const{pageSize:e,currentPage:l}=C;return yield me(z({page:t(l),limit:t(e)},t(V)),a)})}),{dataList:$,loading:R,total:A,pageSize:u,currentPage:h}=C,{getList:y,delList:T,getSelections:O,exportQueryList:K}=D,j=p([]);v(this,null,function*(){const e=yield ke().getDictObj(["sys_vadmin_gender"]);j.value=e.sys_vadmin_gender});const X=q([{field:"selection",type:"selection",show:!0,disabled:!0},{field:"id",label:"用户编号",width:"100px",show:!1,disabled:!1},{field:"name",label:"姓名",show:!0,disabled:!0},{field:"nickname",label:"昵称",show:!0},{field:"telephone",label:"手机号",show:!0,disabled:!0},{field:"email",label:"邮箱",show:!0,disabled:!0},{field:"gender",label:"性别",show:!1,slots:{default:a=>{const e=a.row;return s(k,null,[s("div",null,[ye(t(j),e.gender)])])}}},{field:"roles",label:"角色",show:!0,slots:{default:a=>{const e=a.row;return s(k,null,[s("div",{class:"text-truncate"},[e.roles.map(l=>l.name).join()])])}}},{field:"depts",label:"部门",show:!0,slots:{default:a=>{const e=a.row;return s(k,null,[s("div",{class:"text-truncate"},[e.depts.map(l=>l.name).join()])])}}},{field:"is_active",label:"是否可用",show:!1,slots:{default:a=>{const e=a.row;return s(k,null,[s(Q,{modelValue:e.is_active,disabled:!0},null)])}}},{field:"is_staff",label:"工作人员",show:!0,slots:{default:a=>{const e=a.row;return s(k,null,[s(Q,{modelValue:e.is_staff,disabled:!0},null)])}}},{field:"last_login",label:"最近登录时间",show:!0,width:"190px"},{field:"create_datetime",label:"创建时间",width:"190px",show:!1},{field:"action",width:"150px",label:"操作",show:!0,slots:{default:a=>{const e=a.row,l=["auth.user.update"],d=["auth.user.delete"];return s(k,null,[b(s(w,{type:"primary",link:!0,size:"small",onClick:()=>Z(e)},{default:()=>[_("编辑")]}),[[G("hasPermi"),l]]),b(s(w,{type:"danger",loading:U.value,link:!0,size:"small",onClick:()=>I(e)},{default:()=>[_("删除")]}),[[G("hasPermi"),d]])])}}}]),Y=q([{field:"name",label:"姓名",component:"Input",componentProps:{clearable:!1,style:{width:"214px"}},formItemProps:{labelWidth:"47px"}},{field:"telephone",label:"手机号",component:"Input",componentProps:{clearable:!1,style:{width:"214px"}}},{field:"is_active",label:"状态",component:"Select",componentProps:{style:{width:"214px"},options:[{label:"正常",value:!0},{label:"停用",value:!1}]}},{field:"is_staff",label:"工作人员",component:"Select",componentProps:{style:{width:"214px"},options:[{label:"是",value:!0},{label:"否",value:!1}]}}]),V=p({}),F=a=>{h.value=1,V.value=a,y()},U=p(!1),I=a=>v(this,null,function*(){U.value=!0,a?yield T(!0,[a.id]).finally(()=>{U.value=!1}):yield T(!0).finally(()=>{U.value=!1})}),f=p(!1),x=p(""),L=p(),r=p(""),M=p(),E=p(!1),Z=a=>v(this,null,function*(){const e=yield ue(a.id);e&&(x.value="编辑用户",e.data.role_ids=e.data.roles.map(l=>l.id),e.data.dept_ids=e.data.depts.map(l=>l.id),r.value="edit",L.value=e.data,f.value=!0)}),ee=()=>{x.value="新增用户",r.value="add",L.value=void 0,f.value=!0},te=()=>{x.value="批量导入用户",r.value="import",L.value=void 0,f.value=!0},S=p([]),ae=()=>v(this,null,function*(){if(S.value=yield O(),S.value.length>0)x.value="重置密码并发送短信",r.value="sms",L.value=void 0,f.value=!0;else return W.warning("请先选择数据")}),le=()=>v(this,null,function*(){if(S.value=yield O(),S.value.length>0)x.value="重置密码并发送邮件",r.value="email",L.value=void 0,f.value=!0;else return W.warning("请先选择数据")}),se=()=>v(this,null,function*(){const a=t(M),e=yield a==null?void 0:a.submit();if(e){E.value=!0;try{const l=p({});r.value==="add"?(l.value=yield ce(e),l.value&&(f.value=!1,y())):r.value==="edit"&&(l.value=yield fe(e),l.value&&(f.value=!1,y()))}finally{E.value=!1}}});return(a,e)=>{const l=G("hasPermi");return m(),Ae(k,null,[s(t(ge),null,{default:i(()=>[s(t(_e),{schema:Y,onReset:F,onSearch:F},null,8,["schema"]),s(t(we),{"current-page":t(h),"onUpdate:currentPage":e[2]||(e[2]=d=>H(h)?h.value=d:null),"page-size":t(u),"onUpdate:pageSize":e[3]||(e[3]=d=>H(u)?u.value=d:null),showAction:"",columns:X,"default-expand-all":"","node-key":"id",data:t($),loading:t(R),pagination:{total:t(A)},onRegister:t(o),onRefresh:t(y)},{toolbar:i(()=>[s(t(Pe),{gutter:10},{default:i(()=>[b((m(),g(t(P),{span:1.5},{default:i(()=>[s(t(w),{type:"primary",onClick:ee},{default:i(()=>[_("新增用户")]),_:1})]),_:1})),[[l,["auth.user.create"]]]),b((m(),g(t(P),{span:1.5},{default:i(()=>[s(t(w),{onClick:te},{default:i(()=>[_("批量导入用户")]),_:1})]),_:1})),[[l,["auth.user.import"]]]),b((m(),g(t(P),{span:1.5},{default:i(()=>[s(t(w),{onClick:e[0]||(e[0]=d=>t(K)())},{default:i(()=>[_("导出筛选用户")]),_:1})]),_:1})),[[l,["auth.user.export"]]]),b((m(),g(t(P),{span:1.5},{default:i(()=>[s(t(w),{onClick:ae},{default:i(()=>[_("重置密码通知短信")]),_:1})]),_:1})),[[l,["auth.user.reset"]]]),b((m(),g(t(P),{span:1.5},{default:i(()=>[s(t(w),{onClick:le},{default:i(()=>[_("重置密码通知邮件")]),_:1})]),_:1})),[[l,["auth.user.reset"]]]),b((m(),g(t(P),{span:1.5},{default:i(()=>[s(t(w),{type:"danger",onClick:e[1]||(e[1]=d=>I(null))},{default:i(()=>[_("批量删除")]),_:1})]),_:1})),[[l,["auth.user.delete"]]])]),_:1})]),_:1},8,["current-page","page-size","columns","data","loading","pagination","onRegister","onRefresh"])]),_:1}),s(t(be),{modelValue:f.value,"onUpdate:modelValue":e[5]||(e[5]=d=>f.value=d),title:x.value,height:600,width:r.value==="sms"||r.value==="email"?"1000px":"700px"},De({default:i(()=>[r.value==="add"||r.value==="edit"?(m(),g(he,{key:0,ref_key:"writeRef",ref:M,"current-row":L.value},null,8,["current-row"])):r.value==="import"?(m(),g(xe,{key:1,onGetList:t(y)},null,8,["onGetList"])):r.value==="sms"?(m(),g(Le,{key:2,selections:S.value,onGetList:t(y)},null,8,["selections","onGetList"])):r.value==="email"?(m(),g(Se,{key:3,selections:S.value,onGetList:t(y)},null,8,["selections","onGetList"])):Ue("",!0)]),_:2},[r.value==="add"||r.value==="edit"?{name:"footer",fn:i(()=>[s(t(w),{type:"primary",loading:E.value,onClick:se},{default:i(()=>[_(J(t(n)("exampleDemo.save")),1)]),_:1},8,["loading"]),s(t(w),{onClick:e[4]||(e[4]=d=>f.value=!1)},{default:i(()=>[_(J(t(n)("dialogDemo.close")),1)]),_:1})]),key:"0"}:void 0]),1032,["modelValue","title","width"])],64)}}});export{Dt as default};
