var E=(d,f,u)=>new Promise((v,p)=>{var g=t=>{try{n(u.next(t))}catch(c){p(c)}},x=t=>{try{n(u.throw(t))}catch(c){p(c)}},n=t=>t.done?v(t.value):Promise.resolve(t.value).then(g,x);n((u=u.apply(d,f)).next())});import{u as M,F as U}from"./useForm-BREZWcm3.js";import{u as j}from"./useValidator-B2HgF5Uc.js";import{I as z}from"./index-BSaZkSQ-.js";/* empty css                    *//* empty css                        */import{Z as G,b,ak as L}from"./element-plus-BkD8NzPH.js";import{l as N,Z as S,U as a,S as r,F as P,a as m,b as q,m as I,p as A,u as F,M as Z,R as H}from"./vue-chunks-o2h5QaLn.js";const $=N({__name:"Write",props:{currentRow:{type:Object,default:()=>null}},setup(d,{expose:f}){const{required:u}=j(),v=d,p=S([{field:"upload_method",label:"上传方式",colProps:{span:24},component:"RadioGroup",componentProps:{options:[{label:"同时上传",value:"1"},{label:"按顺序上传",value:"2"}]},value:"1",formItemProps:{rules:[u()]}},{field:"images",label:"",colProps:{span:24},formItemProps:{rules:[u()],slots:{default:()=>a(P,null,[a("div",{class:"flex justify-between w-[100%]"},[a("span",null,[r("图片资源")]),a("span",null,[r("最大数量限制："),s.value.length,r("/"),i.value])]),a(G,{class:"resource-image-uploader",action:"#","http-request":_,"file-list":s.value,"onUpdate:file-list":e=>s.value=e,"show-file-list":!0,multiple:!0,"before-upload":C,"on-success":D,"on-preview":R,"on-exceed":y,accept:"image/jpeg,image/png",name:"file","list-type":"picture-card",limit:i.value,drag:!0,disabled:i.value<=s.value.length},{default:()=>[s.value.length<i.value?a("div",{class:"resource-image-uploader-icon"},[a(z,{icon:"akar-icons:plus",size:23},null),a("span",{class:"text-[12px]"},[r("点击或拖拽到这里")]),a("span",{class:"text-[12px]"},[s.value.length,r("/"),i.value])]):a("div",{class:"resource-image-uploader-icon"},[a("span",{class:"text-[12px]"},[r("已到最大限制")]),a("span",{class:"text-[12px]"},[s.value.length,r("/"),i.value])])]})])}}}]),{formRegister:g,formMethods:x}=M(),{setValues:n,getFormData:t,getElFormExpose:c,setValue:V}=x,h=m(!1),w=m(0),i=m(50),s=m([]),C=e=>{const l=["image/jpeg","image/gif","image/png"].includes(e.type),o=e.size/1024/1024<3;return l||b.error("上传图片素材必须是 JPG/PNG/ 格式!"),o||b.error("上传图片素材大小不能超过 3MB!"),l&&o},D=(e,l,o)=>{s.value=o,V("images",o)},_=e=>new Promise(l=>{l(e)}),R=e=>{w.value=s.value.findIndex(l=>l.uid===e.uid),h.value=!0},k=()=>{h.value=!1},y=()=>{b.error("上传失败，超出图片最大数量限制!")},B=()=>E(this,null,function*(){const e=yield c();if(yield e==null?void 0:e.validate())return yield t()});return q(()=>v.currentRow,e=>{e&&n(e)},{deep:!0,immediate:!0}),f({submit:B}),(e,l)=>(I(),A(P,null,[a(F(U),{onRegister:F(g),schema:p},null,8,["onRegister","schema"]),h.value?(I(),Z(F(L),{key:0,"z-index":9999,onClose:k,"url-list":s.value.map(o=>o.url),"initial-index":w.value},null,8,["url-list","initial-index"])):H("",!0)],64))}});export{$ as _};
