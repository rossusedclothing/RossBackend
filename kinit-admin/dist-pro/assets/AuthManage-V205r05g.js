var g=(p,T,m)=>new Promise((f,x)=>{var r=i=>{try{_(m.next(i))}catch(h){x(h)}},v=i=>{try{_(m.throw(i))}catch(h){x(h)}},_=i=>i.done?f(i.value):Promise.resolve(i.value).then(r,v);_((m=m.apply(p,T)).next())});import{I as U,A as F,_ as H}from"./index-BSaZkSQ-.js";import{e as S}from"./tree-D8D4nCL3.js";/* empty css                   *//* empty css                   *//* empty css                 *//* empty css                    *//* empty css                  *//* empty css                  *//* empty css                */import{u as z}from"./dict-DVpgL_Jf.js";import{c as J}from"./menu-D7cFiqfc.js";import{c as q}from"./dept-0M1_IU1X.js";import{p as G}from"./role-gkQ4wKNK.js";import{ac as B,ad as P,s as R,ae as Q,F as W,G as X,af as A,ag as Y,ah as Z,b as I}from"./element-plus-BkD8NzPH.js";import{l as $,a as c,b as ee,ai as ae,m as k,p as O,U as n,O as u,u as e,q as o,T as te,S as se,F as oe,a7 as le,M as ne,R as re,aH as ie,aI as de,n as M}from"./vue-chunks-o2h5QaLn.js";import"./dict-Ua4YypUZ.js";const E=p=>(ie("data-v-458fbc02"),p=p(),de(),p),ce={class:"auth-manage-main-view"},ue={class:"flex justify-between pt-[20px] pb-[20px]"},pe=E(()=>o("span",null,"权限管理",-1)),fe={class:"h-12 flex justify-between mt-3 mr-3 ml-5"},me={class:"mt-1 text-[#909399]"},ve={class:"border-r-1 border-r-[#f0f0f0] b-r-solid h-[100%] p-[20px] box-border"},_e=E(()=>o("div",{class:"flex items-center"},[o("div",{class:"yxt-divider"}),o("span",null,"数据权限")],-1)),he={class:"ml-4 mt-3"},be={key:0,class:"mt-3 max-h-[65vh] b-1 b-solid b-[#e5e7eb] p-10px overflow-auto"},ye=E(()=>o("div",{class:"flex items-center"},[o("div",{class:"yxt-divider"}),o("span",null,"菜单权限")],-1)),ge={class:"mt-5 max-h-[70vh] b-1 b-solid b-[#e5e7eb] p-10px overflow-auto box-border"},xe=$({__name:"AuthManage",props:{currentRow:{type:Object,default:()=>null}},emits:["getList"],setup(p,{expose:T,emit:m}){const f=p,x=m,r=c({});ee(()=>f.currentRow,t=>{t&&(r.value=JSON.parse(JSON.stringify(t)))},{deep:!0,immediate:!0});const v=c(!1),_=c(),i=()=>g(this,null,function*(){const a=yield z().getDictObj(["sys_vadmin_data_range"]);_.value=a.sys_vadmin_data_range}),h={children:"children",label:"label"};let V=c([]);const w=c(),N=()=>g(this,null,function*(){var a;const t=yield q();if(t&&(V.value=t.data,yield M(),f.currentRow)){const d=f.currentRow.depts.map(l=>l.id),s=[];S(t.data,l=>{d.includes(l.value)&&s.push(l.value)});for(const l of s)(a=e(w))==null||a.setChecked(l,!0,!1)}});let D=c([]);const b=c(),K=()=>g(this,null,function*(){var a;const t=yield J();if(t&&(D.value=t.data,yield M(),f.currentRow)){const d=f.currentRow.menus.map(l=>l.id),s=[];S(t.data,l=>{d.includes(l.value)&&s.push(l.value)});for(const l of s)(a=e(b))==null||a.setChecked(l,!0,!1)}}),y=c(!1),j=()=>g(this,null,function*(){var a,d,s;if(y.value)return;if(F(r.value.data_range)){I.error("数据范围选择项不能为空！");return}y.value=!0;const t=[...((a=e(b))==null?void 0:a.getCheckedKeys())||[],...((d=e(b))==null?void 0:d.getHalfCheckedKeys())||[]];r.value.menu_ids=t,r.value.dept_ids=(s=e(w))==null?void 0:s.getCheckedKeys();try{(yield G(r.value))&&(y.value=!1,I.success("保存成功"),C(),x("getList"))}finally{y.value=!1}}),L=()=>{v.value=!0,K(),N()},C=()=>{var t,a;v.value=!1,r.value={},(t=e(b))==null||t.setCheckedKeys([]),(a=e(w))==null||a.setCheckedKeys([])};return i(),T({openDrawer:L}),(t,a)=>{const d=ae("BaseButton");return k(),O("div",ce,[n(e(Z),{modelValue:v.value,"onUpdate:modelValue":a[1]||(a[1]=s=>v.value=s),"with-header":!1,size:1e3,"before-close":C},{default:u(()=>[n(e(B),null,{default:u(()=>[n(e(P),null,{default:u(()=>[o("div",ue,[pe,o("span",{onClick:C,class:"flex cursor-pointer"},[n(e(U),{icon:"iconamoon:close-thin",size:23})])])]),_:1}),n(e(R)),o("div",fe,[o("div",me,[o("span",null,"角色名称："+te(r.value.name),1)]),n(d,{type:"primary",loading:y.value,onClick:j},{default:u(()=>[se("保存")]),_:1},8,["loading"])]),n(e(R)),n(e(B),null,{default:u(()=>[n(e(Q),{width:"450px"},{default:u(()=>[o("div",ve,[o("div",null,[_e,o("div",he,[n(e(W),{modelValue:r.value.data_range,"onUpdate:modelValue":a[0]||(a[0]=s=>r.value.data_range=s),placeholder:"请选择数据范围"},{default:u(()=>[(k(!0),O(oe,null,le(_.value,s=>(k(),ne(e(X),{key:s.value,label:s.label,value:s.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),r.value.data_range==="3"?(k(),O("div",be,[n(e(A),{ref_key:"deptTreeRef",ref:w,data:e(V),"show-checkbox":"","node-key":"value",props:h,"default-expand-all":!0,"check-strictly":!0},null,8,["data"])])):re("",!0)])])])]),_:1}),n(e(Y),null,{default:u(()=>[ye,o("div",ge,[n(e(A),{ref_key:"menuTreeRef",ref:b,data:e(D),"show-checkbox":"","node-key":"value",props:h,"default-expand-all":!0,"check-strictly":!1},null,8,["data"])])]),_:1})]),_:1})]),_:1}),n(e(R))]),_:1},8,["modelValue"])])}}}),Le=H(xe,[["__scopeId","data-v-458fbc02"]]);export{Le as default};
