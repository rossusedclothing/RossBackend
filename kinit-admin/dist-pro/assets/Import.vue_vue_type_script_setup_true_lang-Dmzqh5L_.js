var _=(E,g,u)=>new Promise((w,c)=>{var i=o=>{try{f(u.next(o))}catch(p){c(p)}},h=o=>{try{f(u.throw(o))}catch(p){c(p)}},f=o=>o.done?w(o.value):Promise.resolve(o.value).then(i,h);f((u=u.apply(E,g)).next())});import{Z as S,$ as U}from"./index-BSaZkSQ-.js";/* empty css                *//* empty css               *//* empty css                        *//* empty css                    */import"./el-tooltip-l0sNRNKZ.js";/* empty css                  *//* empty css                    *//* empty css                      *//* empty css                   */import{r as x,j as C,Z as I,a4 as N,p as X,t as d,ai as V,u as T,b as v}from"./element-plus-BkD8NzPH.js";import{l as j,a as b,ai as q,m as k,p as A,q as n,U as t,O as s,S as m,u as a,T as z,M as L,F as Z}from"./vue-chunks-o2h5QaLn.js";const $=n("span",null,"导入步骤：",-1),K={style:{"margin-top":"7px"}},O=n("li",{style:{"margin-top":"7px"}},"编辑模板文件，（将需要导入的数据按格式填写进去）",-1),P=n("li",{style:{"margin-top":"7px"}},"上传模板文件，点击确认导入",-1),R=n("li",{style:{"margin-top":"7px"}},"查看导入结果，是否全部导入",-1),G={class:"mt-10px"},H={class:"flex justify-between mr-10px"},J=n("span",null,"导入结果",-1),Q={style:{color:"red"}},ue=j({__name:"Import",emits:["getList"],setup(E,{emit:g}){const u=g,w=l=>{const e=["application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"].includes(l.type),r=l.size/1024/1024<10;return e||v.error("上传文件必须是 XLSX 格式!"),r||v.error("上传文件大小不能超过 10MB!"),e&&r},c=b(),i=b([]),h=b([]),f=l=>_(this,null,function*(){i.value=[],i.value.push({filename:l.file.name,filesize:(l.file.size/1024).toFixed(1)+"KB",status:"上传成功"}),c.value=l.file}),o=()=>{i.value=[],c.value=null},p=b(!1),B=b(0),D=()=>_(this,null,function*(){p.value=!0;const l=new FormData;l.append("file",c.value);try{const e=yield S(l);e&&(h.value.push({filename:c.value.name,success_number:e.data.success_number,error_number:e.data.error_number,error_url:e.data.error_url}),B.value+=e.data.success_number,o(),u("getList"))}finally{p.value=!1}}),F=()=>_(this,null,function*(){v.info("正在下载请稍等！");const l=yield U();if(l){const e=document.createElement("a");e.style.display="none",e.href=l.data.url,e.target="_blank",e.download=l.data.filename;const r=new MouseEvent("click");e.dispatchEvent(r)}}),M=l=>_(this,null,function*(){v.info("正在下载请稍等！");const e=document.createElement("a");e.style.display="none",e.href=l.error_url,e.target="_blank",e.download=l.filename;const r=new MouseEvent("click");e.dispatchEvent(r)});return(l,e)=>{const r=q("BaseButton");return k(),A(Z,null,[n("div",null,[$,n("ol",null,[n("li",K,[t(a(x),{onClick:F,target:"_blank",type:"primary"},{default:s(()=>[m(" 下载最新批量导入模板 ")]),_:1})]),O,P,R])]),n("div",null,[t(a(X),{gutter:10,class:"!mt-0 !mr-0"},{default:s(()=>[t(a(C),{span:1.5},{default:s(()=>[n("div",null,[t(a(I),{action:"","http-request":f,data:{path:"users"},"show-file-list":!1,"before-upload":w,accept:".xlsx",disabled:i.value.length>0},{default:s(()=>[t(a(N),{effect:"dark",content:"只支持上传XLSX文件",placement:"top"},{default:s(()=>[t(r,{type:"primary",size:"small",disabled:i.value.length>0},{default:s(()=>[m("上传文件")]),_:1},8,["disabled"])]),_:1})]),_:1},8,["disabled"])])]),_:1}),t(a(C),{span:1.5},{default:s(()=>[t(r,{type:"primary",size:"small",disabled:i.value.length===0,loading:p.value,onClick:D},{default:s(()=>[m("确认导入")]),_:1},8,["disabled","loading"])]),_:1})]),_:1}),t(a(T),{data:i.value,border:!0,style:{width:"100%"},class:"mt-10px"},{default:s(()=>[t(a(d),{prop:"filename",label:"文件名称",align:"left"}),t(a(d),{prop:"filesize",label:"文件大小",width:"100",align:"center"}),t(a(d),{prop:"status",label:"上传状态",width:"100",align:"center"}),t(a(d),{fixed:"right",label:"操作",width:"130",align:"center"},{default:s(()=>[t(a(V),{title:"确认删除吗?",onConfirm:o},{reference:s(()=>[t(r,{link:"",type:"primary",size:"small"},{default:s(()=>[m("删除")]),_:1})]),_:1})]),_:1})]),_:1},8,["data"])]),n("div",G,[n("div",H,[J,n("span",null,"成功导入总数："+z(B.value),1)]),t(a(T),{data:h.value,border:!0,style:{width:"100%"},class:"mt-10px"},{default:s(()=>[t(a(d),{prop:"filename",label:"文件名称",align:"left"}),t(a(d),{prop:"success_number",label:"成功数量",width:"100",align:"center"}),t(a(d),{prop:"error_number",label:"失败数量",width:"100",align:"center"},{default:s(y=>[n("span",Q,z(y.row.error_number),1)]),_:1}),t(a(d),{fixed:"right",label:"操作",width:"130",align:"center"},{default:s(y=>[y.row.error_number>0?(k(),L(a(x),{key:0,onClick:W=>M(y.row),target:"_blank",type:"primary"},{default:s(()=>[m("下载失败数据")]),_:2},1032,["onClick"])):(k(),L(a(x),{key:1,type:"success",underline:!1},{default:s(()=>[m("成功全部导入")]),_:1}))]),_:1})]),_:1},8,["data"])])],64)}}});export{ue as _};
