var P=Object.defineProperty;var L=Object.getOwnPropertySymbols;var R=Object.prototype.hasOwnProperty,Z=Object.prototype.propertyIsEnumerable;var T=(u,o,d)=>o in u?P(u,o,{enumerable:!0,configurable:!0,writable:!0,value:d}):u[o]=d,U=(u,o)=>{for(var d in o||(o={}))R.call(o,d)&&T(u,d,o[d]);if(L)for(var d of L(o))Z.call(o,d)&&T(u,d,o[d]);return u};var E=(u,o,d)=>new Promise((C,_)=>{var V=s=>{try{w(d.next(s))}catch(r){_(r)}},S=s=>{try{w(d.throw(s))}catch(r){_(r)}},w=s=>s.done?C(s.value):Promise.resolve(s.value).then(V,S);w((d=d.apply(u,o)).next())});import{l as G,Z as b,a as $,d as J,m as Q,p as W,q as p,U as e,a8 as X,u as t,O as m,S as f,T as x,aH as Y,aI as ee}from"./vue-chunks-o2h5QaLn.js";import{_ as te}from"./index-BSaZkSQ-.js";/* empty css                        *//* empty css                    */import"./el-tooltip-l0sNRNKZ.js";/* empty css                  *//* empty css                      *//* empty css                 *//* empty css                  *//* empty css                  *//* empty css                   *//* empty css                     *//* empty css                       */import{g as ae,a as le,u as oe,c as se,d as ie}from"./customer-DILA4COA.js";import{D as h,d as v,t as y,u as re,v as de,H as q,B as ne,C as I,b as g,w as me}from"./element-plus-BkD8NzPH.js";const z=u=>(Y("data-v-2deeecff"),u=u(),ee(),u),ue={class:"p-4"},pe={class:"flex items-center justify-between mb-4"},ce={class:"flex items-center space-x-2"},fe={class:"text-sm text-gray-500"},_e={class:"mt-4 flex justify-end"},ve={class:"space-y-2"},ge=z(()=>p("strong",null,"手机号：",-1)),be=z(()=>p("strong",null,"名称：",-1)),he=z(()=>p("strong",null,"平台：",-1)),ye=z(()=>p("div",null,[p("strong",null,"元数据：")],-1)),Ce=G({__name:"CustomerInfo",setup(u){const o=b({page:1,limit:10,total:0,v_order:"desc"}),d=$([]),C=b({keyword:""}),_=()=>E(this,null,function*(){var l;const a={page:o.page,limit:o.limit,keyword:C.keyword,v_order:o.v_order};try{const c=yield ae(a);c&&c.data?(d.value=c.data||[],o.total=(l=c.data.total)!=null?l:0):(d.value=[],o.total=0)}catch(c){console.error("fetchList error",c),g.error("获取客户列表失败")}}),V=()=>{o.page=1,_()},S=a=>{o.page=a,_()},w=a=>{o.limit=a,o.page=1,_()},s=b({visible:!1,data:null}),r=b({visible:!1,isEdit:!1,data_id:0}),D=$(),n=b({customer_name:"",customer_phone:"",platform:"whatsapp",meta_data:""}),F=b({customer_name:[{required:!0,message:"请输入客户名称",trigger:"blur"}],customer_phone:[{required:!0,message:"请输入手机号",trigger:"blur"}]}),M=a=>{a!=null&&a.id?le(a.id).then(l=>{l&&l.data?s.data=l.data:s.data=a,s.visible=!0}).catch(()=>{s.data=a,s.visible=!0}):(s.data=a,s.visible=!0)},N=a=>{r.isEdit=!0,r.data_id=a.id,n.customer_name=a.customer_name||"",n.customer_phone=a.customer_phone||"",n.platform=a.platform||"whatsapp",n.meta_data=a.meta_data||"",r.visible=!0},j=()=>{r.isEdit=!1,r.data_id=0,n.customer_name="",n.customer_phone="",n.platform="whatsapp",n.meta_data="",r.visible=!0},H=()=>{r.visible=!1},K=()=>{var a,l;(l=(a=D.value)==null?void 0:a.validate)==null||l.call(a,c=>E(this,null,function*(){if(c)if(r.isEdit&&r.data_id)try{yield oe(r.data_id,U({},n)),g.success("更新成功"),r.visible=!1,_()}catch(i){g.error("更新失败")}else try{yield se(U({},n)),g.success("创建成功"),r.visible=!1,_()}catch(i){g.error("创建失败")}}))},O=a=>{me.confirm("确认删除该客户吗？","删除确认",{type:"warning"}).then(()=>E(this,null,function*(){try{yield ie([a.id]),g.success("删除成功"),_()}catch(l){g.error("删除失败")}})).catch(()=>{})};return J(()=>{_()}),(a,l)=>{var c;return Q(),W("div",ue,[p("div",pe,[p("div",ce,[e(t(h),{modelValue:C.keyword,"onUpdate:modelValue":l[0]||(l[0]=i=>C.keyword=i),placeholder:"搜索手机号或姓名",clearable:"",onClear:V,onKeydown:X(V,["enter"])},null,8,["modelValue"]),e(t(v),{plain:!0,onClick:V},{default:m(()=>[f("搜索")]),_:1}),e(t(v),{type:"primary",onClick:j},{default:m(()=>[f("创建客户")]),_:1})]),p("div",fe,"总数："+x(o.total),1)]),e(t(re),{data:d.value,stripe:"",style:{width:"100%"},"empty-text":"暂无数据"},{default:m(()=>[e(t(y),{prop:"id",label:"ID",width:"80"}),e(t(y),{prop:"customer_name",label:"客户名称"}),e(t(y),{prop:"customer_phone",label:"手机号"}),e(t(y),{prop:"platform",label:"平台",width:"120"}),e(t(y),{prop:"meta_data",label:"元数据","show-overflow-tooltip":""}),e(t(y),{label:"操作",width:"220"},{default:m(i=>[e(t(v),{size:"small",onClick:k=>M(i.row)},{default:m(()=>[f("查看")]),_:2},1032,["onClick"]),e(t(v),{size:"small",type:"primary",onClick:k=>N(i.row)},{default:m(()=>[f("编辑")]),_:2},1032,["onClick"]),e(t(v),{size:"small",type:"danger",onClick:k=>O(i.row)},{default:m(()=>[f("删除")]),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"]),p("div",_e,[e(t(de),{background:"",layout:"prev, pager, next, sizes, total","page-size":o.limit,"current-page":o.page,"page-sizes":[10,20,50,100],total:o.total,onSizeChange:w,onCurrentChange:S},null,8,["page-size","current-page","total"])]),e(t(q),{modelValue:s.visible,"onUpdate:modelValue":l[2]||(l[2]=i=>s.visible=i),width:"600px",title:"客户详情 - "+(((c=s.data)==null?void 0:c.customer_name)||"")},{footer:m(()=>[e(t(v),{onClick:l[1]||(l[1]=i=>s.visible=!1)},{default:m(()=>[f("关闭")]),_:1})]),default:m(()=>{var i,k,B,A;return[p("div",ve,[p("div",null,[ge,f(x((i=s.data)==null?void 0:i.customer_phone),1)]),p("div",null,[be,f(x((k=s.data)==null?void 0:k.customer_name),1)]),p("div",null,[he,f(x((B=s.data)==null?void 0:B.platform),1)]),ye,e(t(h),{type:"textarea",rows:6,"model-value":(A=s.data)==null?void 0:A.meta_data,disabled:""},null,8,["model-value"])])]}),_:1},8,["modelValue","title"]),e(t(q),{modelValue:r.visible,"onUpdate:modelValue":l[7]||(l[7]=i=>r.visible=i),width:"640px",title:r.isEdit?"编辑客户":"创建客户"},{footer:m(()=>[e(t(v),{onClick:H},{default:m(()=>[f("取消")]),_:1}),e(t(v),{type:"primary",onClick:K},{default:m(()=>[f(x(r.isEdit?"保存":"创建"),1)]),_:1})]),default:m(()=>[e(t(ne),{model:n,rules:F,ref_key:"formRef",ref:D,"label-width":"120px",class:"space-y-2"},{default:m(()=>[e(t(I),{label:"客户名称",prop:"customer_name"},{default:m(()=>[e(t(h),{modelValue:n.customer_name,"onUpdate:modelValue":l[3]||(l[3]=i=>n.customer_name=i)},null,8,["modelValue"])]),_:1}),e(t(I),{label:"手机号",prop:"customer_phone"},{default:m(()=>[e(t(h),{modelValue:n.customer_phone,"onUpdate:modelValue":l[4]||(l[4]=i=>n.customer_phone=i)},null,8,["modelValue"])]),_:1}),e(t(I),{label:"平台",prop:"platform"},{default:m(()=>[e(t(h),{modelValue:n.platform,"onUpdate:modelValue":l[5]||(l[5]=i=>n.platform=i)},null,8,["modelValue"])]),_:1}),e(t(I),{label:"元数据",prop:"meta_data"},{default:m(()=>[e(t(h),{type:"textarea",rows:4,modelValue:n.meta_data,"onUpdate:modelValue":l[6]||(l[6]=i=>n.meta_data=i)},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue","title"])])}}}),Fe=te(Ce,[["__scopeId","data-v-2deeecff"]]);export{Fe as default};
