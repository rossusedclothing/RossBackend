var c=(z,V,p)=>new Promise((m,v)=>{var w=u=>{try{C(p.next(u))}catch(y){v(y)}},x=u=>{try{C(p.throw(u))}catch(y){v(y)}},C=u=>u.done?m(u.value):Promise.resolve(u.value).then(w,x);C((p=p.apply(z,V)).next())});import{g as P,c as Q,u as q,a as J,d as A,b as W}from"./activationcode-BfZdqtEL.js";import"./index-SAHUQZ2g.js";/* empty css                  *//* empty css                   *//* empty css                     *//* empty css                 *//* empty css                       *//* empty css                  *//* empty css                      *//* empty css               *//* empty css                  *//* empty css                        *//* empty css                    */import"./el-tooltip-l0sNRNKZ.js";import{d,t as n,u as X,v as Y,B as Z,C as k,D as j,F,G as T,H as ee,b as _,w as ae}from"./element-plus-C0vem28W.js";import{f as le,a as g,Q as U,d as te,ag as oe,h as D,i as B,j as h,M as a,G as t,K as r,u as e,H as se,E as ie,L as de,F as $,$ as M}from"./vue-chunks-wbK7PffK.js";const ne={class:"p-6"},re={class:"flex justify-between items-center mb-4"},ue=h("h2",{class:"text-xl font-semibold"},"激活码管理",-1),ce={class:"space-x-2"},pe={style:{display:"-webkit-box","-webkit-line-clamp":"2","-webkit-box-orient":"vertical",overflow:"hidden","word-break":"break-all"}},me={class:"flex justify-between flex-grow"},Ae=le({__name:"ActivationCode",setup(z){const V=g([]),p=g(!1),m=g(!1),v=g(!1),w=g([]),x=g(0),C=[{label:"trial-试用",value:"trial"},{label:"personal-个人",value:"personal"},{label:"team-团队",value:"team"},{label:"enterprise-企业",value:"enterprise"}],u=[{label:"active-未使用",value:"active"},{label:"used-已使用",value:"used"},{label:"expired-已过期",value:"expired"},{label:"revoked-已撤销",value:"revoked"}],y=U({page:1,limit:10,v_order:"desc",v_order_field:void 0}),o=U({id:null,code:"",type:"trial",status:"active",user_limit:1,duration_days:30}),b=()=>c(this,null,function*(){var i;p.value=!0;try{const s=Object.assign(y,{}),E=yield P(s);V.value=E.data||[],x.value=((i=E.data)==null?void 0:i.length)||0}finally{p.value=!1}}),O=()=>{v.value=!1,Object.assign(o,{id:null,code:"",type:"trial",status:"active",user_limit:1,duration_days:30}),m.value=!0},I=i=>c(this,null,function*(){Object.assign(o,i);const s={code:o.code,type:o.type,user_id:"1",status:o.status};yield Q(s),b()}),S=i=>{v.value=!0,Object.assign(o,i),m.value=!0},G=()=>c(this,null,function*(){try{v.value&&o.id?(yield q(o.id,o),_.success("更新成功")):(yield J(o),_.success("创建成功")),m.value=!1,b()}catch(i){_.error("操作失败")}}),N=()=>c(this,null,function*(){ae.confirm("确认删除选中的激活码吗？","提示").then(()=>c(this,null,function*(){yield A(w.value),_.success("删除成功"),b()}))}),R=i=>c(this,null,function*(){yield A([i.id]),_.success("删除成功"),b()}),H=i=>{w.value=i.map(s=>s.id)},L=()=>c(this,null,function*(){const i=yield W();i.data&&i.data.length>0&&(o.code=i.data[0])}),K=i=>c(this,null,function*(){navigator.clipboard.writeText(i).then(()=>{_.success("复制成功")}).catch(()=>{_.error("复制失败")})});return te(b),(i,s)=>{const E=oe("loading");return D(),B("div",ne,[h("div",re,[ue,h("div",ce,[a(e(d),{type:"primary",onClick:O},{default:t(()=>[r("新增")]),_:1}),a(e(d),{type:"success",onClick:b},{default:t(()=>[r("刷新")]),_:1}),a(e(d),{type:"danger",disabled:!w.value.length,onClick:N},{default:t(()=>[r("删除")]),_:1},8,["disabled"])])]),se((D(),ie(e(X),{data:V.value,border:"",onSelectionChange:H,class:"rounded-lg shadow"},{default:t(()=>[a(e(n),{fixed:"",type:"selection",width:"50"}),a(e(n),{prop:"id",label:"ID",width:"80"}),a(e(n),{prop:"code",label:"激活码",tooltipEffect:"",width:"100"},{default:t(l=>[h("label",pe,de(l.row.code),1),a(e(d),{size:"small",bg:"",dark:"",onClick:f=>K(l.row.code)},{default:t(()=>[r("复制")]),_:2},1032,["onClick"])]),_:1}),a(e(n),{prop:"type",label:"类型",width:"100"}),a(e(n),{prop:"status",label:"状态",width:"100"}),a(e(n),{prop:"user_limit",label:"用户数限制|激活次数",width:"120"}),a(e(n),{prop:"duration_days",label:"有效天数",width:"100"}),a(e(n),{prop:"activated_by",label:"激活人"}),a(e(n),{prop:"activated_datetime",label:"激活时间"}),a(e(n),{fixed:"right",label:"操作",width:"160"},{default:t(l=>[a(e(d),{size:"small",type:"warning",onClick:f=>I(l.row)},{default:t(()=>[r("激活测试")]),_:2},1032,["onClick"]),a(e(d),{size:"small",type:"primary",onClick:f=>S(l.row)},{default:t(()=>[r("编辑")]),_:2},1032,["onClick"]),a(e(d),{size:"small",type:"danger",onClick:f=>R(l.row)},{default:t(()=>[r("删除")]),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"])),[[E,p.value]]),a(e(Y),{class:"mt-4",background:"",layout:"prev, pager, next","page-size":y.limit,total:x.value,onCurrentChange:b},null,8,["page-size","total"]),a(e(ee),{modelValue:m.value,"onUpdate:modelValue":s[6]||(s[6]=l=>m.value=l),title:v.value?"编辑激活码":"新增激活码",width:"500px"},{footer:t(()=>[a(e(d),{onClick:s[5]||(s[5]=l=>m.value=!1)},{default:t(()=>[r("取消")]),_:1}),a(e(d),{type:"primary",onClick:G},{default:t(()=>[r("保存")]),_:1})]),default:t(()=>[a(e(Z),{model:o,"label-width":"100px"},{default:t(()=>[a(e(k),{label:"激活码"},{default:t(()=>[h("div",me,[a(e(j),{modelValue:o.code,"onUpdate:modelValue":s[0]||(s[0]=l=>o.code=l)},null,8,["modelValue"]),a(e(d),{class:"ml-2",onClick:L},{default:t(()=>[r("生成")]),_:1})])]),_:1}),a(e(k),{label:"类型"},{default:t(()=>[a(e(F),{modelValue:o.type,"onUpdate:modelValue":s[1]||(s[1]=l=>o.type=l),placeholder:"选择类型"},{default:t(()=>[(D(),B($,null,M(C,(l,f)=>a(e(T),{key:f,label:l.label,value:l.value},null,8,["label","value"])),64))]),_:1},8,["modelValue"])]),_:1}),a(e(k),{label:"状态"},{default:t(()=>[a(e(F),{modelValue:o.status,"onUpdate:modelValue":s[2]||(s[2]=l=>o.status=l),placeholder:"选择状态"},{default:t(()=>[(D(),B($,null,M(u,(l,f)=>a(e(T),{key:f,label:l.label,value:l.value},null,8,["label","value"])),64))]),_:1},8,["modelValue"])]),_:1}),a(e(k),{label:"用户限制"},{default:t(()=>[a(e(j),{modelValue:o.user_limit,"onUpdate:modelValue":s[3]||(s[3]=l=>o.user_limit=l)},null,8,["modelValue"])]),_:1}),a(e(k),{label:"有效天数"},{default:t(()=>[a(e(j),{modelValue:o.duration_days,"onUpdate:modelValue":s[4]||(s[4]=l=>o.duration_days=l)},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])])}}});export{Ae as _};
